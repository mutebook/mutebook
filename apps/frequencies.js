!function(t){var s={};function e(r){if(s[r])return s[r].exports;var i=s[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}e.m=t,e.c=s,e.d=function(t,s,r){e.o(t,s)||Object.defineProperty(t,s,{configurable:!1,enumerable:!0,get:r})},e.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},e.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(s,"a",s),s},e.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},e.p="",e(e.s=0)}([function(t,s,e){"use strict";function r(){r.made||(r.made=!0,Object.prototype.forAll=function(t){if(this instanceof Object)for(const s in this)this.hasOwnProperty(s)&&t(this[s],s);else t(this,0)},Array.prototype.forAll=function(t){this.forEach((s,e)=>t(s,e))},Array.prototype.insert=function(t,s){this.splice(t,0,s)})}function i(t=n.NaN){return t instanceof n?t:new n(t)}e.r(s);class n extends Number{constructor(t=n.NaN){super(t.valueOf())}$(t){return new this.constructor(t)}get isNaN(){return Number.isNaN(this.valueOf())}get isDef(){return!this.isNaN}get isPos(){return 0<this}get isNeg(){return 0>this}get is0(){return 0==this}get abs(){return this.$(Math.abs(this))}isNear(t){return 1e-8>this.sub(t).abs}add(t){return this.$(this+t)}sub(t){return this.$(this-t)}mul(t){return this.$(this*t)}div(t){return this.$(this/t)}neg(){return this.$(-this)}idv(t){return this.$(Math.floor(this/t))}mod(t){return this.$(this%t)}eq(t){return this.valueOf()==t}ne(t){return this.valueOf()!=t}lt(t){return this.valueOf()<t}le(t){return this.valueOf()<=t}gt(t){return this.valueOf()>t}ge(t){return this.valueOf()>=t}floor(){return this.$(Math.floor(this))}ceil(){return this.$(Math.ceil(this))}round(){return this.$(Math.round(this))}negate(t){return t?this.neg():this}norm(t,s){let e=this.valueOf();if(e<t||s<=e){const r=s-t;e-=t,e-=Math.floor(e/r)*r,(e+=t)>=s&&(e=t)}return this.$(e)}clamp(t,s){return this.$(Math.max(Math.min(this,s),t))}clamp01(){return this.clamp(0,1)}min(t){return this.$(Math.min(this,t))}max(t){return this.$(Math.max(this,t))}inv(){return this.$(this.is0?n.NaN:1/this)}sqrt(){return this.$(Math.sqrt(this))}log2(){return this.$(Math.log(this)*Math.LOG2E)}exp2(){return this.$(Math.exp(this/Math.LOG2E))}log10(){return this.$(Math.log(this)*Math.LOG10E)}exp10(){return this.$(Math.exp(this/Math.LOG10E))}pow(t){return this.$(Math.pow(this,t))}sin(){return this.$(Math.sin(this))}cos(){return this.$(Math.cos(this))}tan(){return this.$(Math.tan(this))}asin(){return this.$(Math.asin(this))}acos(){return this.$(Math.acos(this))}atan(){return this.$(Math.atan(this))}fromScale(t,s){return i(t+this*(s-t))}intoScale(t,s){return i((this-t)/(s-t))}scale(t,s,e,r){return this.intoScale(t,s).fromScale(e,r)}}function h(t=n.NaN){return new o(t)}n.rand=((t,s)=>i(t+Math.random()*(s-t)));class o extends n{toDeg(){return a(this/Math.PI*180)}}function a(t=n.NaN){return new u(t)}class u extends n{toRad(){return h(this*Math.PI/180)}sin(){return this.toRad().sin()}cos(){return this.toRad().cos()}tan(){return this.toRad().tan()}asin(){return h(super.asin()).toDeg()}acos(){return h(super.acos()).toDeg()}atan(){return h(super.atan()).toDeg()}}function l(t,s){return new d(t,s)}function c(){return l(0,0)}class d{constructor(t,s){0>t&&(t=-t,s+=180),this._r=t.valueOf(),this._a=i(s).norm(0,360).valueOf()}get r(){return i(this._r)}get a(){return a(this._a)}toString(){return`[${this.r}\\${this.a}]`}get is0(){return 0==this.r}isNear(t){return this.r.isNear(t.r)&&this.a.isNear(t.a)}add(t){return this.toXY().add(t.toXY()).toRA()}eq(t){return this._r==t.r&&this._a==t.a}toXY(){return g(this._r*this.a.cos(),this._r*this.a.sin())}}function _(t,s){return t instanceof x?t:Array.isArray(t)?x.fromArray(t):null==t?null:g(t,s)}function g(t,s){return new x(t,s)}function f(){return g(0,0)}function m(t){return g(t,t)}d._0=c(),d.fromArray=(t=>l(t[0],t[1]));class x{constructor(t,s){this._x=t.valueOf(),this._y=s.valueOf()}get x(){return i(this._x)}get y(){return i(this._y)}toString(){return`[${this._x}:${this._y}]`}toArray(){return[this.x,this.y]}_toSvg(){return`${this._x.toFixed(1)} ${this._y.toFixed(1)}`}get is0(){return this.eq(x._0)}isNear(t){return this.x.isNear(t.x)&&this.y.isNear(t.y)}add(t){return t instanceof x?g(this._x+t._x,this._y+t._y):g(this._x+t,this._y+t)}sub(t){return t instanceof x?g(this._x-t._x,this._y-t._y):g(this._x-t,this._y-t)}mul(t){return t instanceof x?g(this._x*t._x,this._y*t._y):g(this._x*t,this._y*t)}div(t){return t instanceof x?g(this._x/t._x,this._y/t._y):g(this._x/t,this._y/t)}neg(){return g(-this._x,-this._y)}mag(){return i(this._x*this._x+this._y*this._y)}lgt(){return this.mag().sqrt()}dot(t){return i(this._x*t.x+this._y*t.y)}cross(t){return i(this._x*t.y-this._y*t.x)}unit(){const t=this.lgt();return 0<t?this.div(t):g(1,0)}eq(t){return this._x==t.x&&this._y==t.y}ne(t){return!this.eq(t)}min(){return Math.min(this._x,this._y)}max(){return Math.max(this._x,this._y)}toRA(){const t=this.lgt();if(t.le(0))return c();const s=this.x,e=this.y;return l(t,s.isNear(0)?e.isNear(0)?0:e.isPos?90:270:a(e.div(s)).atan().add(s.isPos?0:180))}}x._0=f(),x.fromArray=(t=>g(t[0],t[1])),x.fromXY=(t=>g(t.x,t.y)),x.fromWH=(t=>g(t.width,t.height)),r();class w{constructor(t){this.el=w.elSel(t)}get isShown(){return!this.hasClass("hidden")}show(t=!0){this.toggleClass("hidden",!t)}hide(){this.show(!1)}get style(){return this.el.style}set width(t){this.style.width=`${t}px`}set height(t){this.style.height=`${t}px`}set color(t){this.style.color=t}set background(t){this.style.background=t}addClass(t){t.forAll(t=>this.el.classList.add(t))}remClass(t){t.forAll(t=>this.el.classList.remove(t))}toggleClass(t,s){t.forAll(t=>this.el.classList.toggle(t,s))}hasClass(t){return this.el.classList.contains(t)}get sz(){return g(this.el.clientWidth,this.el.clientHeight)}set sz(t){this.width=t.x,this.height=t.y}get bsz(){return x.fromWH(this.el.getBoundingClientRect())}}w.elSel=(t=>t instanceof Element?t:t instanceof w?t.el:document.querySelector(t));class b extends w{constructor(t,s=null){super(t),this._onWindowResize=null,s&&(this.sz=s),this._resizeEvent(),window.addEventListener("resize",this._resizeEvent)}get minSize(){return 0}_resizeEvent(){this._onWindowResize&&this._onWindowResize(g(window.innerWidth,window.innerHeight))}set onWindowResize(t){this._onWindowResize=t,this._resizeEvent()}availableRectangle(){const t=this.el.parentElement;return g(t.clientWidth,t.clientHeight)}}function A(t,s){return new y(t,s)}function v(){return A(x._0,x._0)}class y{constructor(t,s){this.tr=_(t),this.sc=_(s)}toString(){return`(${this.tr}/${this.sc})`}get is0(){return this.tr.is0&&this.sc.is0}isNear(t){return this.tr.isNear(t.tr)&&this.sc.isNear(t.sc)}eq(t){return this.tr.eq(t.tr)&&this.sc.eq(t.sc)}svgString(){let t="";return this.tr.is0||(t+=`translate(${this.tr.x} ${this.tr.y}) `),this.sc.is0||(t+=`scale(${this.sc.x} ${this.sc.y})`),t}add(t){return A(this.tr.add(t.tr),this.sc.add(t.sc))}}y._0=v();class k{}k.navigator=window.navigator,k.userAgent=k.navigator.userAgent,k.isChrome=!!k.userAgent.match("Chrome"),k.isFF=!!k.userAgent.match("Firefox"),k.isSafari=!k.isChrome&&!!k.userAgent.match("Safari"),k.isIOS=!!k.userAgent.match("iPad|iPhone|iPod"),k.alert=(t=>window.alert(t.toString())),k.touchPoints=k.isIOS?1:k.navigator.maxTouchPoints?k.navigator.maxTouchPoints:0,k.isTouch=k.touchPoints>0,k.oneStream=((t,s,e,r)=>t.addEventListener(k.isTouch?e:s,r)),r();class S{constructor(){this.group=null,this.scene=null,this.el=null,this._sceneNodeAttrs()}_setScene(t){this.scene=t}_setGroup(t){this.group=t,this._setScene(t.scene)}getAttr(t){return this.el.getAttribute(t)}setAttr(t,s){s?this.el.setAttribute(t,s):this.el.removeAttribute(t)}setAttrs(t){t.forAll((t,s)=>this.setAttr(s,t))}isShown(){return"none"!=this.getAttr("display")}show(t=!0){this.setAttr("display",t?"":"none")}hide(){this.show(!1)}set stroke(t){this.setAttr("stroke",t)}get stroke(){return this.getAttr("stroke")}set fill(t){this.setAttr("fill",t)}get fill(){this.getAttr("fill")}set color(t){this.stroke=t,this.fill=t}set width(t){this.setAttr("stroke-width",t)}set lineCap(t){this.setAttr("stroke-linecap",t)}set lineJoin(t){this.setAttr("stroke-linejoin",t)}set dashArray(t){this.setAttr("stroke-dasharray",t)}solidStroke(t=null){this.dashArray=null,t&&(this.stroke=t)}dottedStroke(t=null){this.dashArray="1,3",t&&(this.stroke=t)}dashedStroke(t=null){this.dashArray="3,2",t&&(this.stroke=t)}$attrs(){this._sceneNodeAttrs()}_sceneNodeAttrs(){}}class $ extends S{constructor(){super(),this.nodes=[],this._trf=v(),this.el=R.elem("g"),this._bg=null,this._fg=null,this._groupNodeAttrs()}_setScene(t){super._setScene(t),this.nodes.forAll(s=>s._setScene(t))}isRoot(){return null==this.group}isEmpty(){return!!this.nodes.length}back(t){return this.nodes.length?(this.nodes.unshift(t),this.el.insertBefore(t.el,this.el.firstChild),t._setGroup(this),t):this.front(t)}front(t){return this.nodes.push(t),this.el.appendChild(t.el),t._setGroup(this),t}clear(){let t;for(this.nodes=[];t=this.el.firstChild;)this.el.removeChild(t)}get g(){return this.front(new $)}get bg(){return this._bg?this._bg:this._bg=this.back(new $)}get fg(){return this._fg?this._fg:this._fg=this.front(new $)}get trf(){return this._trf}set trf(t){this._trf=t,this._attrTR()}get p(){return this._trf.tr}set p(t){this.trf=A(t,this.trf.sc)}get gp(){return null==this.group?this.p:this.parent.p.add(this.p)}set sc(t){this.trf=A(this.trf.tr,t)}$attrs(){super.$attrs(),this._groupNodeAttrs()}_attrTR(){this.setAttr("transform",this._trf.svgString())}_groupNodeAttrs(){this._attrTR()}}class M extends ${constructor(){super(),this.labels=[]}centerLabels(){this.labels.forAll(t=>t.center())}}class P extends M{constructor(t){super(),this.container=t,this.scene=this,this.el=t.innerElem,this._lastPointerPos=f(),this.offX=0,this.offY=0,this.cursor=null,this._sceneAttrs()}interactive(){function t(t){return g(t.clientX,t.clientY)}let s;k.oneStream(this.el,"mousedown","touchstart",e=>{this._mn&&(s=this._mn.p.sub(t(e)))}),k.oneStream(this.el,"mousemove","touchmove",e=>{e.preventDefault(),this._mn&&this._mn.moveTo(s.add(t(e)),!0)}),k.oneStream(this.el,"mouseup","touchend",t=>{this._mn=null}),this._mn=null}_move(t){this._mn=t}$attrs(){super.$attrs(),this._sceneAttrs()}_sceneAttrs(){this.stroke="black",this.fill="none",this.width=1,this.lineCap="round"}}class T extends b{constructor(t,s,e=null){super(t,e),this.el.append(this.innerElem=s),this.style.position="relative";const r=s.style;r.position="absolute",r.width="100%",r.height="100%",this.scene=new P(this)}get minSize(){return 32}get bg(){return this.scene.bg}get fg(){return this.scene.fg}setMouse(t){this.el.addEventListener("mousedown",()=>{this._isMouseDown=!0}),this.el.addEventListener("mouseup",()=>{this._isMouseDown=!1}),this.el.addEventListener("mousemove",s=>{this._isMouseDown&&s.preventDefault(),t(g(s.offsetX,s.offsetY))})}}class R extends T{constructor(t,s=null){super(t,R.elem("svg"),s)}get svgElem(){return this.innerElem}}R.elem=(t=>document.createElementNS("http://www.w3.org/2000/svg",t)),R.div=((t=null)=>{const s=(t,s=null)=>{const e=document.createElement(t);return s&&e.classList.add(s),e},e=s("div",t),r=(t,r=null)=>e.appendChild(s(t,r));return e.br=(()=>(e.appendChild(s("br")),e)),e.label=(t=>{const s=r("label");return s.innerText=t,s}),e.input=(t=>{const s=r("input");return s.type=t,s}),e.radio=((t,s=null,r=null)=>{let i=e.input("radio");return t&&(i.name=t),s&&e.label(s),r&&(i.onclick=r),i.check=(()=>i.checked=!0),i}),e.button=((t,s=!1,e=null)=>{const i=r("button");return i.innerText=t,s&&(i.classList.add("toggle"),i.toggle=(()=>i.classList.toggle("down"))),e&&(i.onclick=e),i}),e.check=((t=null,s=!1)=>{let r=e.input("checkbox");return t&&e.label(t),s&&(r.onchange=(()=>s(r.checked))),r.check=(()=>r.checked=!0),r}),e.range=((t,s,r,i)=>{const n=e.input("range");return n.min=t,n.max=s,n.step=r>0?r:(s-t)/60,n.value=t,n.oninput=i,n}),e});class C extends S{constructor(){super()}get p(){return f()}set p(t){}get sz(){return f()}set cursor(t){this.setAttr("cursor",t)}get cursor(){return this.getAttr("cursor")}movable(t=null,s=null){this.cursor="pointer",this._onMove=t,k.oneStream(this.el,"mousedown","touchstart",t=>{s&&s(this.p,this),this.scene._move(this)})}moveTo(t,s=!1){if(t=_(t),!this._isMoving){if(this._isMoving=!0,this._onMove){const e=this._onMove(t,this,s);e&&(t=e)}this.p=t,delete this._isMoving}}set markerBeg(t){this.setAttr("marker-start",t)}set markerEnd(t){this.setAttr("marker-end",t)}arrowBeg(){this.markerBeg="url(#arrowBeg)"}arrowEnd(){this.markerEnd="url(#arrowEnd)"}}class E extends C{constructor(t){super(),this._p=_(t)}get p(){return this._p}set p(t){this._p=_(t),this._attrP()}_attrP(){}$attrs(){super.$attrs(),this._attrP()}}class N extends C{constructor(t){super(),this._ps=t,this._sc=m(1),this._tr=f()}get p(){return this._ps.isEmpty?f():this._ps.first}set p(t){if(t=_(t),this._ps.isEmpty)return;const s=t.sub(this._ps.first);this._ps=this._ps.map(t=>t.add(s)),this._attrD()}get ps(){return this._ps}set ps(t){this._ps=t,this._attrD()}get sc(){return this._sc}set sc(t){this._sc=_(t),this._attrD()}get tr(){return this._tr}set tr(t){this._tr=_(t),this._attrD()}set(t,s=null,e=null){this._ps=t,s&&(this.sc=s),e&&(this.tr=e),this._attrD()}get trans(){let t=this._ps;return this._sc&&(t=t.map(t=>t.mul(this._sc))),this._tr&&(t=t.map(t=>t.add(this._tr))),t}_attrD(){}$attrs(){super.$attrs(),this._attrD()}}class z extends S{constructor(t){super(),this.el=R.elem("marker"),this.el.id=t}}class O extends z{constructor(t){super(t),this.setAttr("markerUnits","strokeWidth"),this.setAttr("markerWidth","5"),this.setAttr("markerHeight","4"),this.setAttr("orient","auto"),this.setAttr("viewBox","0 0 10 10"),this.setAttr("fill","black"),this.setAttr("refX","5"),this.setAttr("refY","5");const s=new q;s.setAttr("d","M 10 0 L 0 5 L 10 10 z"),this.el.appendChild(s.el)}}class D extends z{constructor(t){super(t),this.setAttr("markerUnits","strokeWidth"),this.setAttr("markerWidth","5"),this.setAttr("markerHeight","4"),this.setAttr("orient","auto"),this.setAttr("viewBox","0 0 10 10"),this.setAttr("fill","black"),this.setAttr("refX","5"),this.setAttr("refY","5");const s=new q;s.setAttr("d","M 0 0 L 10 5 L 0 10 z"),this.el.appendChild(s.el)}}k.isTouch;class L extends E{constructor(t,s,e=null,r=null){super(t),this._s=s,this._size=e,this._font=r,this.el=R.elem("text"),this._labelAttrs()}center(){const t=this.el.getBBox();this.p=this.p.sub(g(t.width/2,-t.height/4))}leftBelow(){const t=this.el.getBBox();this.p=this.p.sub(g(t.width,-t.height))}get s(){return this._s}set s(t){this._s=t,this._attrText()}get font(){return this._font}set font(t){this._font=t,this._attrFont()}get size(){return this._size}set size(t){this._size=t,this._attrSize()}_attrP(){this.setAttr("x",this._p.x),this.setAttr("y",this._p.y)}_attrFont(){this.setAttr("font-family",this._font)}_attrSize(){this.setAttr("font-size",this._size)}_attrText(){this.el.textContent=this._s}_labelAttrs(){this.setAttr("x",this._p.x),this.setAttr("y",this._p.y),this._attrFont(),this._attrSize(),this._attrText()}$attrs(){super.$attrs(),this._labelAttrs()}}function B(t,s,e,r="black",i="none"){let n=new L(s,e);return n.fill=r,n.stroke=i,n=t.front(n),t instanceof M&&t.labels.push(n),n}class q extends N{constructor(t=null){super(null==t?[]:t),this.el=R.elem("path"),this._pathAttrs()}_seg(t){return t.x.toFixed(1)+","+t.y.toFixed(1)+" "}_d(){let t="";if(this._ps.length>0){const s=this.trans;t+="M"+this._seg(s.first);for(let e in s.skip(1))t+="L"+this._seg(e)}return t}_attrD(){this.setAttr("d",this._d())}_pathAttrs(){this._attrD()}$attrs(){super.$attrs(),this._pathAttrs()}}class F extends q{constructor(t=!0,s=null){super(s),this._stripEnds=t}_bezier(){const t=this._stripEnds?1:0,s=this._ps.length;if(s<3+2*t)return"";const e=this.trans;let r=e[0],i=e[0+t],n=e[1+t],h=e[2+t],o="M"+this._seg(i);for(let a=6,u=2+t;;){let l=n.sub(r).div(a),c=h.sub(i).div(a);if(o+="C"+this._seg(i.add(l))+this._seg(n.sub(c))+this._seg(n),++u>s-t)break;r=i,i=n,n=h,h=e[u<s?u:u-1]}return o}_d(){return this._bezier()}}const W=function(t,s=2){let e=new b(t).availableRectangle();s&&(e=g(e.x,e.x/s));let r=new X(t,e);return r._arrowBegEnd(),r};class X extends R{constructor(t,s=null){super(t,s),this.scene.interactive(),this.addClass("quint"),k.isTouch&&this.addClass("touch");const e=this.overDiv=R.div("overlay");this.el.appendChild(e),e.controls=(()=>(e._controls||e.appendChild(e._controls=R.div("controls")),e._controls)),e.centerAt=((t,s)=>{let e=t.style;e.position="absolute",e.left=s.x-t.clientWidth/2+"px",e.top=s.y-t.clientHeight/2+"px"}),this._margin=0}fbo(){return[this.fg,this.bg,this.overDiv]}_arrowBegEnd(){this._arrowBeg||this.svgElem.append((this._arrowBeg=new O("arrowBeg")).el),this._arrowEnd||this.svgElem.append((this._arrowEnd=new D("arrowEnd")).el)}get m(){return i(this._margin)}msz(t=14){this._margin=t=t.valueOf();const s=super.sz,e=s.x,r=s.y,n=t,h=e-t,o=t,a=r-t;return[i(h-n),i(a-o),i(e/2),i(r/2),i(n),i(h),i(o),i(a)]}radialGradient(t,s,e){let r;for(void 0==this._defs&&this.innerElem.append(this._defs=R.elem("defs")),void 0==this._rg&&(this._defs.append(this._rg=R.elem("radialGradient")),this._rg.id=t);r=this._rg.firstChild;)this._rg.removeChild(r);for(var i=0;i<s.length;++i){var n=R.elem("stop");this._rg.append(n),n.setAttribute("offset",s[i]),n.setAttribute("stop-color",e[i])}}}class Y extends ${constructor(){super()}}class G{}G._concertA=440;class V extends n{toString(){return this<1?this.toFixed(4).toString():this<10?this.toFixed(3).toString():this<100?this.toFixed(2).toString():this<1e3?this.toFixed(1).toString():(this/1e3).toString()+"k"}toPch(){return this.isPos?Q(this.div(j).log2()+U):J}toCts(){return this.toPch().toCts()}}function H(t=0){return new V(t)}V.minAudible=H(8),V.maxAudible=H(24e3);H(G._concertA);const j=H(G._concertA/1.681792830507427);class I extends n{toPch(){return Q(this.log2())}toCts(){return this.toPch().toCts()}}class K extends n{toCps(){return H(this.sub(U).exp2().mul(j))}toRat(){return function(t=1){return new I(t)}(this.exp2())}toEdo(t=12){return function(t=12){return new tt(t)}(this*t)}toCts(){return function(t=0){return new Z(t)}(1200*this)}mulRat(t){return this.toCps().mul(t).toPch()}divRat(t){return this.toCps().div(t).toPch()}harm(t){return this.toCps().mul(t+1).toPch()}edoFloor(t){return this.mul(t).floor().div(t)}edoRound(t){return this.mul(t).round().div(t)}edoCeil(t){return this.mul(t).ceil().div(t)}}function Q(t=0){return new K(t)}Q(8.75);const U=Q(8),J=Q(-1e3);K.minAudible=V.minAudible.toPch(),K.maxAudible=V.maxAudible.toPch(),K.fromMidi=(t=>U().add((t-60)/12));class Z extends n{toPch(){return Q(this/1200)}}class tt extends n{toPch(t){return Q(t/this)}}class st extends Y{constructor(){super()}}class et extends st{constructor(t,s,e,r,n=null){super(),this.minRad=i(t),this.maxRad=i(s),this.minTurn=i(e),this.maxTurn=i(r),this.aOff=i(n||0),this.front(this.sp=new F(!0)),this.update()}get rgeRad(){return maxRad-minRad}get stpRad(){return rgeRad/(maxTurn-minTurn)}get markRad(){return this.stpRad/2.4}update(){let t=[];const s=this.minTurn.mul(24).floor()-1,e=this.maxTurn.mul(24).ceil()+1;for(var r=s;r<=e;++r)t.push(this.t2xy(r/24));this.sp.ps=t}t2r(t){return i(t).scale(this.minTurn,this.maxTurn,this.minRad,this.maxRad)}t2a(t){return 360*i(t)+this.aOff}r2t(t){return i(t).scale(this.minRad,this.maxRad,this.minTurn,this.maxTurn)}a2t(t){return i(t-this.aOff)/360}t2ra(t){return l(this.t2r(t),this.t2a(t))}t2xy(t){return this.t2ra(t).toXY()}}class rt extends ${constructor(t,s,e=null,r=null){this.c1=add(new Circle(f(),0)),this.c2=add(new Circle(f(),0)),this.l=null,this.set(t,s,e,r)}set(t,s,e=null,r=null){const i=s.isPos;this.p=t,this.c1.r=s+1,this.c1.stroke=e||"lightgrey",this.c2.r=s,this.c2.stroke=r||"none",this.c1.show(i),this.c2.show(i),this.l&&(this.l.p=this._lp,this.l.show(i))}get _lp(){return g(this.c1.r,-this.c1.r).mul(8)}setLabel(t){this.l?this.l.s=t:this.l=B(this,this._lp,t,this.c1.stroke)}}class it extends et{constructor(t,s,e,r,n){super(t,s,e,n,-i(r).mod(1).mul(360).add(90)),this.ctrPch=r,this.oldVal=Q(0)}get minPch(){return Q(this.minTurn)}get maxPch(){return Q(this.maxTurn)}get minCps(){return this.minPch.toCps()}get maxCps(){return this.maxPch.toCps()}pch2r(t){return this.t2r(t)}pch2a(t){return this.t2a(t)}r2pch(t){return Q(r2t(t))}a2pch(t){return Q(a2t(t))}pch2ra(t){return t.lt(this.minPch)?ra0():this.t2ra(t)}pch2xy(t){return t.lt(this.minPch)?f():this.t2xy(t)}ra2pch(t){if(t.is0)return Q(0);let s,e=this.a2t(t.a),r=$Inf;for(;;){const i=this.t2r(e).sub(t.r).abs();if(i>r)break;r=i,s=e,e+=1}return Q(s)}xy2pch(t){return this.ra2pch(t.toRA())}lag(t,s=!1){if(!s){let s=t.sub(oldVal);s.abs().ge(.4)&&(t=t.sub(Q(s>0?1:-1)))}return this.oldVal.val=t.val,t}snap(t,s){let e=t,r=9999;return snaps.forAll(s=>{const i=e.sub(s).abs();i<r&&(r=i,t=s)}),t}mark(t,s,e,r=null,i=null){return t.add(new rt(this.pch2xy(s),e,r,i))}setMark(t,s,e,r=null,i=null){t.set(this.pch2xy(s),e,r,i)}labelPch(t,s,e,r="black"){return B(t,this.pch2xy(s).add(g(-8,4)),e,r)}spoke(t,s){const e=pch2a(s);return line(t,l(minRad-7,e).toXY(),l(maxRad+7,e).toXY())}spokes(t,s){return t=t.group(),s.forAll(s=>{spoke(t,s)}),t.hide(),t}markPitch(t,s,e,r=null){e&&mark(t,s,markRad,e),r&&circle(t,p,this.pch2r(s),r)}}const nt=new class{constructor(){this._dest=null}get ctx(){return this._ctx||(this._ctx=new AudioContext,(this._dest=new lt(1)).node.connect(this._ctx.destination)),this._ctx}get sr(){return this.ctx.sampleRate}get now(){return this.ctx.currentTime}get dest(){return this._dest}beep(t,s,e){const r=new ct;r.osc.cps=t,r.sendToDest(),r.start(),r.nowRamps(r.gai.node.gain,.3,e/3*2,0,e/3),r.deleteAfter(e)}testBeep(){nt.beep(880,.3,.12)}};!function(t,s){let e;(e=window.QM)||(e=window.QM={}),e[t]||(e[t]=s())}("Audio",()=>nt),nt.mute=(()=>{nt.dest&&nt.dest.node.gain.linearRampToValueAtTime(0,nt.now+.1)}),nt.after=((t,s)=>{setTimeout(()=>{s()},1e3*t)}),nt.sequence=((...t)=>{const s=()=>{if(t.length){const[e,r]=t.shift();setTimeout(()=>{r(),s()},1e3*e)}};s()}),window.addEventListener("beforeunload",()=>nt.mute());class ht{constructor(){this._startState=0}inlet(){return null}outlet(){return null}start(t=0){return 0===this._startState&&(this.nodeStart(t),this._startState=1,!0)}stop(t=0){return 1===this._startState&&(this.nodeStop(t),this._startState=2,!0)}nodeStart(t){}nodeStop(t){}sendTo(t=null){const s=this.outlet();if(s&&(s.disconnect(),t)){const e=t.inlet();e&&s.connect(e)}}sendToDest(){this.sendTo(nt.dest)}deleteAfter(t){nt.after(t+.01,()=>{this.stop(),this.sendTo()})}rampLin(t,s,e=null,r=null,i=null){null==i&&(i=nt.now),null==e&&(e=i+.01),null!=r&&t.setValueAtTime(r,i),t.linearRampToValueAtTime(s,e)}rampExp(t,s,e=null,r=null,i=null){null==i&&(i=nt.now),null==e&&(e=i+.01),null!=r&&t.setValueAtTime(r,i),t.exponentialRampToValueAtTime(s<=0?1e-6:s,e),t.setValueAtTime(s,e)}ramp(t,s,e=null,r=null,i=null){s<(null!=r?r:t.value)?this.rampExp(t,s,e,r,i):this.rampLin(t,s,e,r,i)}ramps(t,s,...e){let r,i;for(;2<=e.length;){const n=e.shift(),h=e.shift()+s;this.ramp(t,n,h,r,i),r=n,i=h}}nowRamps(t,...s){this.ramps(t,nt.now,...s)}}class ot extends ht{constructor(t){super(),this._node=t}inlet(){return this._node}outlet(){return this._node}}const at=t=>(class extends t{nodeStart(t){return this._node.start(t)}nodeStop(t){return this._node.stop(t)}});class ut extends(at(ot)){constructor(t="sine"){super(nt.ctx.createOscillator()),this.node.type=t,this.cps=0,this.phs=0}get node(){return this._node}get cps(){return this.node.frequency.value}set cps(t){this.ramp(this.node.frequency,t)}get phs(){return this._phs}set phs(t){if(this._phs=t,"sine"!==this.node.type)return;const s=this.node;if(s){const e=l(1,t).toXY(),r=nt.ctx.createPeriodicWave(new Float32Array([0,e.x]),new Float32Array([0,e.y]));s.setPeriodicWave(r)}}}class lt extends ot{constructor(t=0){super(nt.ctx.createGain()),this.ramp(this.node.gain,t)}get node(){return this._node}get amp(){return this.node.gain.value}set amp(t){this.ramp(this.node.gain,t)}get amp2(){return Math.sqrt(this.amp)}set amp2(t){this.amp=t*t}}lt.soft=.3,lt.loud=.7,lt.full=1;class ct extends ht{constructor(t="sine",s=0,e=0){super(),this.osc=new ut(t),this.gai=new lt(s),this.osc.sendTo(this.gai),this.pan=new dt(e),this.gai.sendTo(this.pan)}inlet(){return this.osc.node}outlet(){return this.pan.node}nodeStart(t){this.osc.nodeStart(t)}nodeStop(t){this.osc.nodeStop(t)}}class dt extends ot{constructor(t=0){super(nt.ctx.createStereoPanner()),this.pan=t}get node(){return this._node}get pan(){return this.node.pan.value}set pan(t){this.ramp(this.node.pan,t)}left(){this.pan=-1}center(){this.pan=0}right(){this.pan=1}}class pt extends(at(ot)){constructor(){super(nt.ctx.createBufferSource())}get node(){return this._node}nodeStart(t){this.node.start(t)}nodeStop(t){this.node.stop(t)}createBuffer(t,s){const e=nt.ctx.createBuffer(1,t,nt.sr),r=e.getChannelData(0);for(let e=0;e<t;++e)r[e]=s(e);this.node.buffer=e,this.node.loop=!0}}class _t extends pt{constructor(){super(),this.createBuffer(8*nt.sr,()=>2*Math.random()-1)}}class gt{constructor(){this._b0=0,this._b1=0,this._b2=0,this._b3=0,this._b4=0,this._b5=0,this._b6=0}nextSample(){const t=2*Math.random()-1;this._b0=.99886*this._b0+.0555179*t,this._b1=.99332*this._b1+.0750759*t,this._b2=.969*this._b2+.153852*t,this._b3=.8665*this._b3+.3104856*t,this._b4=.55*this._b4+.5329522*t,this._b5=-.7616*this._b5-.016898*t;const s=.22*(this._b0+this._b1+this._b2+this._b3+this._b4+this._b5+this._b6+.5362*t);return this._b6=.115926*t,s}}class ft extends pt{constructor(){super();const t=new gt;this.createBuffer(8*nt.sr,()=>t.nextSample())}}class mt{static tone(t,s,e="sine"){if(t._klang){const s=t._klang;delete t._klang,s.nowRamps(s.gai.node.gain,0,.23),s.deleteAfter(.3)}else{const r=new ct(e);r.sendToDest(),t._klang=r,r.osc.cps=s,r.start(),r.nowRamps(r.gai.node.gain,.2,.23)}}static _bufferKlang(t,s){if(t._klang){let[s,e]=t._klang;delete t._klang,s.nowRamps(s.node.gain,0,.23),s.deleteAfter(.3),e.deleteAfter(.3)}else{const e=new lt;e.sendToDest();const r=new s;r.sendTo(e),t._klang=[e,r],r.start(),e.nowRamps(e.node.gain,.2,.23)}}static whiteNoise(t){this._bufferKlang(t,_t)}static pinkNoise(t){this._bufferKlang(t,ft)}static noise(t,s){return"white"===s?this.whiteNoise(t):"pink"===s?this.pinkNoise(t):this.tone(t,0)}static sineTone(t=0){const s=new ct("sine",0,t);return s.sendToDest(),s.cps=(t=>s.osc.cps=t),s.amp=(t=>s.gai.amp=t),s.start(),s}}window.app_frequencies=function(t){const s=W(t,1),[e,r,i]=s.fbo(),[n,h,o,a]=s.msz(),u=H;let l=u(50).toPch(),c=u(1e3).toPch(),d=u(2e4).toPch(),p=function(t,s,e,r,i,n,h){const o=new it(e,r,i,n,h);return o.p=s,t.front(o)}(r,g(o,a),h/12,h/2,l,c,d);function _(t,s){s||(s=t.toString());let e=i.button(s,!0,function(){mt.tone(e,t,"sine"),e.toggle()});const r=p.pch2xy(u(t).toPch());i.centerAt(e,r.add(g(o,a)))}p.markPitch(c,"red");for(let t of[[50],[100],[150],[200],[250],[300],[350],[400],[450],[500],[550],[600],[650],[700],[750],[800],[850],[900],[950],[1e3],[1100],[1200],[1300],[1400],[1500],[1600],[1700],[1800],[1900],[2e3],[2100],[2200],[2300],[2400],[2500],[2600],[2700],[2800],[2900],[3e3],[3200],[3400],[3600],[3800],[4e3],[4200],[4400],[4600],[4800],[5e3],[5500],[6e3],[6500],[7e3],[7500],[8e3],[8500],[9e3,"9k"],[1e4,"10k"],[11e3,"11k"],[12e3,"12k"],[13e3,"13k"],[14e3,"14k"],[15e3,"15k"],[16e3,"16k"],[17e3,"17k"],[18e3,"18k"],[19e3,"19k"],[2e4,"20k"]]){let[s,e]=t;_(s,e)}}}]);