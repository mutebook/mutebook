!function(t){var s={};function e(i){if(s[i])return s[i].exports;var r=s[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}e.m=t,e.c=s,e.d=function(t,s,i){e.o(t,s)||Object.defineProperty(t,s,{configurable:!1,enumerable:!0,get:i})},e.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},e.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(s,"a",s),s},e.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},e.p="",e(e.s=0)}([function(t,s,e){"use strict";function i(){i.made||(i.made=!0,Object.prototype.forAll=function(t){if(this instanceof Object)for(const s in this)this.hasOwnProperty(s)&&t(this[s],s);else t(this,0)},Array.prototype.forAll=function(t){this.forEach((s,e)=>t(s,e))},Array.prototype.insert=function(t,s){this.splice(t,0,s)})}function r(t=n.NaN){return t instanceof n?t:new n(t)}e.r(s);class n extends Number{constructor(t=n.NaN){super(t.valueOf())}$(t){return new this.constructor(t)}get isNaN(){return Number.isNaN(this.valueOf())}get isDef(){return!this.isNaN}get isPos(){return 0<this}get isNeg(){return 0>this}get is0(){return 0==this}get abs(){return this.$(Math.abs(this))}isNear(t){return 1e-8>this.sub(t).abs}add(t){return this.$(this+t)}sub(t){return this.$(this-t)}mul(t){return this.$(this*t)}div(t){return this.$(this/t)}neg(){return this.$(-this)}idv(t){return this.$(Math.floor(this/t))}mod(t){return this.$(this%t)}eq(t){return this.valueOf()==t}ne(t){return this.valueOf()!=t}lt(t){return this.valueOf()<t}le(t){return this.valueOf()<=t}gt(t){return this.valueOf()>t}ge(t){return this.valueOf()>=t}floor(){return this.$(Math.floor(this))}ceil(){return this.$(Math.ceil(this))}round(){return this.$(Math.round(this))}negate(t){return t?this.neg():this}norm(t,s){let e=this.valueOf();if(e<t||s<=e){const i=s-t;e-=t,e-=Math.floor(e/i)*i,(e+=t)>=s&&(e=t)}return this.$(e)}clamp(t,s){return this.$(Math.max(Math.min(this,s),t))}clamp01(){return this.clamp(0,1)}min(t){return this.$(Math.min(this,t))}max(t){return this.$(Math.max(this,t))}inv(){return this.$(this.is0?n.NaN:1/this)}sqrt(){return this.$(Math.sqrt(this))}log2(){return this.$(Math.log(this)*Math.LOG2E)}exp2(){return this.$(Math.exp(this/Math.LOG2E))}log10(){return this.$(Math.log(this)*Math.LOG10E)}exp10(){return this.$(Math.exp(this/Math.LOG10E))}pow(t){return this.$(Math.pow(this,t))}sin(){return this.$(Math.sin(this))}cos(){return this.$(Math.cos(this))}tan(){return this.$(Math.tan(this))}asin(){return this.$(Math.asin(this))}acos(){return this.$(Math.acos(this))}atan(){return this.$(Math.atan(this))}fromScale(t,s){return r(t+this*(s-t))}intoScale(t,s){return r((this-t)/(s-t))}scale(t,s,e,i){return this.intoScale(t,s).fromScale(e,i)}}function h(t=n.NaN){return new o(t)}n.rand=((t,s)=>r(t+Math.random()*(s-t)));class o extends n{toDeg(){return a(this/Math.PI*180)}}function a(t=n.NaN){return new l(t)}class l extends n{toRad(){return h(this*Math.PI/180)}sin(){return this.toRad().sin()}cos(){return this.toRad().cos()}tan(){return this.toRad().tan()}asin(){return h(super.asin()).toDeg()}acos(){return h(super.acos()).toDeg()}atan(){return h(super.atan()).toDeg()}}function u(t,s){return new _(t,s)}function c(){return u(0,0)}class _{constructor(t,s){0>t&&(t=-t,s+=180),this._r=t.valueOf(),this._a=r(s).norm(0,360).valueOf()}get r(){return r(this._r)}get a(){return a(this._a)}toString(){return`[${this.r}\\${this.a}]`}get is0(){return 0==this.r}isNear(t){return this.r.isNear(t.r)&&this.a.isNear(t.a)}add(t){return this.toXY().add(t.toXY()).toRA()}eq(t){return this._r==t.r&&this._a==t.a}toXY(){return p(this._r*this.a.cos(),this._r*this.a.sin())}}function d(t,s){return t instanceof f?t:Array.isArray(t)?f.fromArray(t):null==t?null:p(t,s)}function p(t,s){return new f(t,s)}function g(){return p(0,0)}function m(t){return p(t,t)}_._0=c(),_.fromArray=(t=>u(t[0],t[1]));class f{constructor(t,s){this._x=t.valueOf(),this._y=s.valueOf()}get x(){return r(this._x)}get y(){return r(this._y)}toString(){return`[${this._x}:${this._y}]`}toArray(){return[this.x,this.y]}_toSvg(){return`${this._x.toFixed(1)} ${this._y.toFixed(1)}`}get is0(){return this.eq(f._0)}isNear(t){return this.x.isNear(t.x)&&this.y.isNear(t.y)}add(t){return t instanceof f?p(this._x+t._x,this._y+t._y):p(this._x+t,this._y+t)}sub(t){return t instanceof f?p(this._x-t._x,this._y-t._y):p(this._x-t,this._y-t)}mul(t){return t instanceof f?p(this._x*t._x,this._y*t._y):p(this._x*t,this._y*t)}div(t){return t instanceof f?p(this._x/t._x,this._y/t._y):p(this._x/t,this._y/t)}neg(){return p(-this._x,-this._y)}mag(){return r(this._x*this._x+this._y*this._y)}lgt(){return this.mag().sqrt()}dot(t){return r(this._x*t.x+this._y*t.y)}cross(t){return r(this._x*t.y-this._y*t.x)}unit(){const t=this.lgt();return 0<t?this.div(t):p(1,0)}eq(t){return this._x==t.x&&this._y==t.y}ne(t){return!this.eq(t)}min(){return Math.min(this._x,this._y)}max(){return Math.max(this._x,this._y)}toRA(){const t=this.lgt();if(t.le(0))return c();const s=this.x,e=this.y;return u(t,s.isNear(0)?e.isNear(0)?0:e.isPos?90:270:a(e.div(s)).atan().add(s.isPos?0:180))}}f._0=g(),f.fromArray=(t=>p(t[0],t[1])),f.fromXY=(t=>p(t.x,t.y)),f.fromWH=(t=>p(t.width,t.height)),i();class x{constructor(t){this.el=x.elSel(t)}get isShown(){return!this.hasClass("hidden")}show(t=!0){this.toggleClass("hidden",!t)}hide(){this.show(!1)}get style(){return this.el.style}set width(t){this.style.width=`${t}px`}set height(t){this.style.height=`${t}px`}set color(t){this.style.color=t}set background(t){this.style.background=t}addClass(t){t.forAll(t=>this.el.classList.add(t))}remClass(t){t.forAll(t=>this.el.classList.remove(t))}toggleClass(t,s){t.forAll(t=>this.el.classList.toggle(t,s))}hasClass(t){return this.el.classList.contains(t)}get sz(){return p(this.el.clientWidth,this.el.clientHeight)}set sz(t){this.width=t.x,this.height=t.y}get bsz(){return f.fromWH(this.el.getBoundingClientRect())}}x.elSel=(t=>t instanceof Element?t:t instanceof x?t.el:document.querySelector(t));class v extends x{constructor(t,s=null){super(t),this._onWindowResize=null,s&&(this.sz=s),this._resizeEvent(),window.addEventListener("resize",this._resizeEvent)}get minSize(){return 0}_resizeEvent(){this._onWindowResize&&this._onWindowResize(p(window.innerWidth,window.innerHeight))}set onWindowResize(t){this._onWindowResize=t,this._resizeEvent()}availableRectangle(){const t=this.el.parentElement;return p(t.clientWidth,t.clientHeight)}}function b(t,s){return new A(t,s)}function w(){return b(f._0,f._0)}class A{constructor(t,s){this.tr=d(t),this.sc=d(s)}toString(){return`(${this.tr}/${this.sc})`}get is0(){return this.tr.is0&&this.sc.is0}isNear(t){return this.tr.isNear(t.tr)&&this.sc.isNear(t.sc)}eq(t){return this.tr.eq(t.tr)&&this.sc.eq(t.sc)}svgString(){let t="";return this.tr.is0||(t+=`translate(${this.tr.x} ${this.tr.y}) `),this.sc.is0||(t+=`scale(${this.sc.x} ${this.sc.y})`),t}add(t){return b(this.tr.add(t.tr),this.sc.add(t.sc))}}A._0=w();class y{}y.navigator=window.navigator,y.userAgent=y.navigator.userAgent,y.isChrome=!!y.userAgent.match("Chrome"),y.isFF=!!y.userAgent.match("Firefox"),y.isSafari=!y.isChrome&&!!y.userAgent.match("Safari"),y.isIOS=!!y.userAgent.match("iPad|iPhone|iPod"),y.alert=(t=>window.alert(t.toString())),y.touchPoints=y.isIOS?1:y.navigator.maxTouchPoints?y.navigator.maxTouchPoints:0,y.isTouch=y.touchPoints>0,y.oneStream=((t,s,e,i)=>t.addEventListener(y.isTouch?e:s,i)),i();class k{constructor(){this.group=null,this.scene=null,this.el=null,this._sceneNodeAttrs()}_setScene(t){this.scene=t}_setGroup(t){this.group=t,this._setScene(t.scene)}getAttr(t){return this.el.getAttribute(t)}setAttr(t,s){s?this.el.setAttribute(t,s):this.el.removeAttribute(t)}setAttrs(t){t.forAll((t,s)=>this.setAttr(s,t))}isShown(){return"none"!=this.getAttr("display")}show(t=!0){this.setAttr("display",t?"":"none")}hide(){this.show(!1)}set stroke(t){this.setAttr("stroke",t)}get stroke(){return this.getAttr("stroke")}set fill(t){this.setAttr("fill",t)}get fill(){this.getAttr("fill")}set color(t){this.stroke=t,this.fill=t}set width(t){this.setAttr("stroke-width",t)}set lineCap(t){this.setAttr("stroke-linecap",t)}set lineJoin(t){this.setAttr("stroke-linejoin",t)}set dashArray(t){this.setAttr("stroke-dasharray",t)}solidStroke(t=null){this.dashArray=null,t&&(this.stroke=t)}dottedStroke(t=null){this.dashArray="1,3",t&&(this.stroke=t)}dashedStroke(t=null){this.dashArray="3,2",t&&(this.stroke=t)}$attrs(){this._sceneNodeAttrs()}_sceneNodeAttrs(){}}class $ extends k{constructor(){super(),this.nodes=[],this._trf=w(),this.el=z.elem("g"),this._bg=null,this._fg=null,this._groupNodeAttrs()}_setScene(t){super._setScene(t),this.nodes.forAll(s=>s._setScene(t))}isRoot(){return null==this.group}isEmpty(){return!!this.nodes.length}back(t){return this.nodes.length?(this.nodes.unshift(t),this.el.insertBefore(t.el,this.el.firstChild),t._setGroup(this),t):this.front(t)}front(t){return this.nodes.push(t),this.el.appendChild(t.el),t._setGroup(this),t}clear(){let t;for(this.nodes=[];t=this.el.firstChild;)this.el.removeChild(t)}get g(){return this.front(new $)}get bg(){return this._bg?this._bg:this._bg=this.back(new $)}get fg(){return this._fg?this._fg:this._fg=this.front(new $)}get trf(){return this._trf}set trf(t){this._trf=t,this._attrTR()}get p(){return this._trf.tr}set p(t){this.trf=b(t,this.trf.sc)}get gp(){return null==this.group?this.p:this.parent.p.add(this.p)}set sc(t){this.trf=b(this.trf.tr,t)}$attrs(){super.$attrs(),this._groupNodeAttrs()}_attrTR(){this.setAttr("transform",this._trf.svgString())}_groupNodeAttrs(){this._attrTR()}}class S extends ${constructor(){super(),this.labels=[]}centerLabels(){this.labels.forAll(t=>t.center())}}class M extends S{constructor(t){super(),this.container=t,this.scene=this,this.el=t.innerElem,this._lastPointerPos=g(),this.offX=0,this.offY=0,this.cursor=null,this._sceneAttrs()}interactive(){function t(t){return p(t.clientX,t.clientY)}let s;y.oneStream(this.el,"mousedown","touchstart",e=>{this._mn&&(s=this._mn.p.sub(t(e)))}),y.oneStream(this.el,"mousemove","touchmove",e=>{e.preventDefault(),this._mn&&this._mn.moveTo(s.add(t(e)),!0)}),y.oneStream(this.el,"mouseup","touchend",t=>{this._mn=null}),this._mn=null}_move(t){this._mn=t}$attrs(){super.$attrs(),this._sceneAttrs()}_sceneAttrs(){this.stroke="black",this.fill="none",this.width=1,this.lineCap="round"}}class T extends v{constructor(t,s,e=null){super(t,e),this.el.append(this.innerElem=s),this.style.position="relative";const i=s.style;i.position="absolute",i.width="100%",i.height="100%",this.scene=new M(this)}get minSize(){return 32}get bg(){return this.scene.bg}get fg(){return this.scene.fg}setMouse(t){this.el.addEventListener("mousedown",()=>{this._isMouseDown=!0}),this.el.addEventListener("mouseup",()=>{this._isMouseDown=!1}),this.el.addEventListener("mousemove",s=>{this._isMouseDown&&s.preventDefault(),t(p(s.offsetX,s.offsetY))})}}class z extends T{constructor(t,s=null){super(t,z.elem("svg"),s)}get svgElem(){return this.innerElem}}z.elem=(t=>document.createElementNS("http://www.w3.org/2000/svg",t)),z.div=((t=null)=>{const s=(t,s=null)=>{const e=document.createElement(t);return s&&e.classList.add(s),e},e=s("div",t),i=(t,i=null)=>e.appendChild(s(t,i));return e.br=(()=>(e.appendChild(s("br")),e)),e.label=(t=>{const s=i("label");return s.innerText=t,s}),e.input=(t=>{const s=i("input");return s.type=t,s}),e.radio=((t,s=null,i=null)=>{let r=e.input("radio");return t&&(r.name=t),s&&e.label(s),i&&(r.onclick=i),r.check=(()=>r.checked=!0),r}),e.button=((t,s=!1,e=null)=>{const r=i("button");return r.innerText=t,s&&(r.classList.add("toggle"),r.toggle=(()=>r.classList.toggle("down"))),e&&(r.onclick=e),r}),e.check=((t=null,s=!1)=>{let i=e.input("checkbox");return t&&e.label(t),s&&(i.onchange=(()=>s(i.checked))),i.check=(()=>i.checked=!0),i}),e.range=((t,s,i,r)=>{const n=e.input("range");return n.min=t,n.max=s,n.step=i>0?i:(s-t)/60,n.value=t,n.oninput=r,n}),e});class E extends k{constructor(){super()}get p(){return g()}set p(t){}get sz(){return g()}set cursor(t){this.setAttr("cursor",t)}get cursor(){return this.getAttr("cursor")}movable(t=null,s=null){this.cursor="pointer",this._onMove=t,y.oneStream(this.el,"mousedown","touchstart",t=>{s&&s(this.p,this),this.scene._move(this)})}moveTo(t,s=!1){if(t=d(t),!this._isMoving){if(this._isMoving=!0,this._onMove){const e=this._onMove(t,this,s);e&&(t=e)}this.p=t,delete this._isMoving}}set markerBeg(t){this.setAttr("marker-start",t)}set markerEnd(t){this.setAttr("marker-end",t)}arrowBeg(){this.markerBeg="url(#arrowBeg)"}arrowEnd(){this.markerEnd="url(#arrowEnd)"}}class N extends E{constructor(t){super(),this._p=d(t)}get p(){return this._p}set p(t){this._p=d(t),this._attrP()}_attrP(){}$attrs(){super.$attrs(),this._attrP()}}class P extends N{constructor(t,s){super(t),this._r=s}get r(){return this._r}set r(t){this._r=t,this._attrR()}_attrR(){}$attrs(){super.$attrs(),this._attrR()}set(t,s){this.p=t,this.r=s}}class R extends E{constructor(t,s){super(),this._p1=d(t),this._p2=d(s)}get p(){return this._p1}set p(t){t=d(t),this._p2=this._p2.add(t.sub(this._p1)),this._p1=t,this._attrP1(),this._attrP2()}get p1(){return this._p1}set p1(t){this._p1=d(t),this._attrP1()}get p2(){return this._p2}set p2(t){this._p2=d(t),this._attrP2()}get sz(){return this._p2.sub(this._p1)}set sz(t){this._p2=this._p1.add(d(t)),this.$attrP2()}set(t,s){this._p1=d(t),this._p2=d(s),this._attrP1(),this._attrP2()}ctr(){return this._p1.add(p2).div(2)}lgt(){return this._p2.sub(this._p1).lgt()}_attrP1(){}_attrP2(){}$attrs(){super.$attrs(),this._attrP1(),this._attrP2()}}class O extends E{constructor(t){super(),this._ps=t,this._sc=m(1),this._tr=g()}get p(){return this._ps.isEmpty?g():this._ps.first}set p(t){if(t=d(t),this._ps.isEmpty)return;const s=t.sub(this._ps.first);this._ps=this._ps.map(t=>t.add(s)),this._attrD()}get ps(){return this._ps}set ps(t){this._ps=t,this._attrD()}get sc(){return this._sc}set sc(t){this._sc=d(t),this._attrD()}get tr(){return this._tr}set tr(t){this._tr=d(t),this._attrD()}set(t,s=null,e=null){this._ps=t,s&&(this.sc=s),e&&(this.tr=e),this._attrD()}get trans(){let t=this._ps;return this._sc&&(t=t.map(t=>t.mul(this._sc))),this._tr&&(t=t.map(t=>t.add(this._tr))),t}_attrD(){}$attrs(){super.$attrs(),this._attrD()}}class C extends k{constructor(t){super(),this.el=z.elem("marker"),this.el.id=t}}class D extends C{constructor(t){super(t),this.setAttr("markerUnits","strokeWidth"),this.setAttr("markerWidth","5"),this.setAttr("markerHeight","4"),this.setAttr("orient","auto"),this.setAttr("viewBox","0 0 10 10"),this.setAttr("fill","black"),this.setAttr("refX","5"),this.setAttr("refY","5");const s=new H;s.setAttr("d","M 10 0 L 0 5 L 10 10 z"),this.el.appendChild(s.el)}}class V extends C{constructor(t){super(t),this.setAttr("markerUnits","strokeWidth"),this.setAttr("markerWidth","5"),this.setAttr("markerHeight","4"),this.setAttr("orient","auto"),this.setAttr("viewBox","0 0 10 10"),this.setAttr("fill","black"),this.setAttr("refX","5"),this.setAttr("refY","5");const s=new H;s.setAttr("d","M 0 0 L 10 5 L 0 10 z"),this.el.appendChild(s.el)}}class L extends R{constructor(t,s){super(t,s),this.el=z.elem("line"),this._lineAttrs()}closeTo(t){const s=this._p2.sub(this._p1),e=d(t).sub(this._p1),i=s.dot(e).div(s.mag()).clamp01();return this._p1.add(s.mul(i))}_attrP1(){this.setAttr("x1",this._p1.x),this.setAttr("y1",this._p1.y)}_attrP2(){this.setAttr("x2",this._p2.x),this.setAttr("y2",this._p2.y)}_lineAttrs(){this._attrP1(),this._attrP2()}$attrs(){super.$attrs(),this._lineAttrs()}}function B(t,s,e,i=null,r=null){const n=new L(s,e);return n.stroke=i,n.fill=r,t.front(n)}class q extends P{constructor(t,s){super(t,s),this.el=z.elem("circle"),this._circleAttrs()}get sz(){return m(2*this._r)}closeTo(t){return this._p.add(d(t).sub(this._p).unit().mul(this._r))}atr(t){return p(this._p.x.add(this._r.mul(a(t).cos())),this._p.y.sub(this._r.mul(a(t).sin())))}atp(t){let s=-a((t=this.closeTo(d(t)).sub(this._p).div(this._r)).y).asin();return 0>t.x&&(s=180-s),0>s&&(s+=360),s}_attrP(){this.setAttr("cx",this._p.x),this.setAttr("cy",this._p.y)}_attrR(){this.setAttr("r",this._r)}_circleAttrs(){this._attrP(),this._attrR()}$attrs(){super.$attrs(),this._circleAttrs()}}function W(t,s,e,i=null,r=null){const n=new q(s,e);return n.stroke=i,n.fill=r,t.front(n)}const F=y.isTouch?9:6,G="yellow";class X extends N{constructor(t,s,e=null,i=null){super(t),this._s=s,this._size=e,this._font=i,this.el=z.elem("text"),this._labelAttrs()}center(){const t=this.el.getBBox();this.p=this.p.sub(p(t.width/2,-t.height/4))}leftBelow(){const t=this.el.getBBox();this.p=this.p.sub(p(t.width,-t.height))}get s(){return this._s}set s(t){this._s=t,this._attrText()}get font(){return this._font}set font(t){this._font=t,this._attrFont()}get size(){return this._size}set size(t){this._size=t,this._attrSize()}_attrP(){this.setAttr("x",this._p.x),this.setAttr("y",this._p.y)}_attrFont(){this.setAttr("font-family",this._font)}_attrSize(){this.setAttr("font-size",this._size)}_attrText(){this.el.textContent=this._s}_labelAttrs(){this.setAttr("x",this._p.x),this.setAttr("y",this._p.y),this._attrFont(),this._attrSize(),this._attrText()}$attrs(){super.$attrs(),this._labelAttrs()}}function Y(t,s,e,i="black",r="none"){let n=new X(s,e);return n.fill=i,n.stroke=r,n=t.front(n),t instanceof S&&t.labels.push(n),n}class H extends O{constructor(t=null){super(null==t?[]:t),this.el=z.elem("path"),this._pathAttrs()}_seg(t){return t.x.toFixed(1)+","+t.y.toFixed(1)+" "}_d(){let t="";if(this._ps.length>0){const s=this.trans;t+="M"+this._seg(s.first);for(let e in s.skip(1))t+="L"+this._seg(e)}return t}_attrD(){this.setAttr("d",this._d())}_pathAttrs(){this._attrD()}$attrs(){super.$attrs(),this._pathAttrs()}}class j extends H{constructor(t=!0,s=null){super(s),this._stripEnds=t}_bezier(){const t=this._stripEnds?1:0,s=this._ps.length;if(s<3+2*t)return"";const e=this.trans;let i=e[0],r=e[0+t],n=e[1+t],h=e[2+t],o="M"+this._seg(r);for(let a=6,l=2+t;;){let u=n.sub(i).div(a),c=h.sub(r).div(a);if(o+="C"+this._seg(r.add(u))+this._seg(n.sub(c))+this._seg(n),++l>s-t)break;i=r,r=n,n=h,h=e[l<s?l:l-1]}return o}_d(){return this._bezier()}}const I=function(t,s=2){let e=new v(t).availableRectangle();s&&(e=p(e.x,e.x/s));let i=new K(t,e);return i._arrowBegEnd(),i};class K extends z{constructor(t,s=null){super(t,s),this.scene.interactive(),this.addClass("quint"),y.isTouch&&this.addClass("touch");const e=this.overDiv=z.div("overlay");this.el.appendChild(e),e.controls=(()=>(e._controls||e.appendChild(e._controls=z.div("controls")),e._controls)),e.centerAt=((t,s)=>{let e=t.style;e.position="absolute",e.left=s.x-t.clientWidth/2+"px",e.top=s.y-t.clientHeight/2+"px"}),this._margin=0}fbo(){return[this.fg,this.bg,this.overDiv]}_arrowBegEnd(){this._arrowBeg||this.svgElem.append((this._arrowBeg=new D("arrowBeg")).el),this._arrowEnd||this.svgElem.append((this._arrowEnd=new V("arrowEnd")).el)}get m(){return r(this._margin)}msz(t=14){this._margin=t=t.valueOf();const s=super.sz,e=s.x,i=s.y,n=t,h=e-t,o=t,a=i-t;return[r(h-n),r(a-o),r(e/2),r(i/2),r(n),r(h),r(o),r(a)]}radialGradient(t,s,e){let i;for(void 0==this._defs&&this.innerElem.append(this._defs=z.elem("defs")),void 0==this._rg&&(this._defs.append(this._rg=z.elem("radialGradient")),this._rg.id=t);i=this._rg.firstChild;)this._rg.removeChild(i);for(var r=0;r<s.length;++r){var n=z.elem("stop");this._rg.append(n),n.setAttribute("offset",s[r]),n.setAttribute("stop-color",e[r])}}}class Q extends j{constructor(){super(),this.ph=null,this.steady=null,this.set()}ampl(t,s=null){return null!=this.steady?this.steady:(null==s&&(s=this.ph),a(360*(t+s)).sin())}set(t=0,s=0,e=null,i=null){this.cycles=t.valueOf(),this.ph=s.valueOf(),this._setPath(e,i)}_setPath(t,s){let e=[];const i=this.cycles;if(i){const t=Math.ceil(12*i);for(let s=-1;s<=t+1;++s){let r=s/t*i;e.push(p(r,-this.ampl(r)))}}super.set(e,t,s)}}function U(t){return t.front(new Q)}class J extends ${constructor(){super()}}class Z extends J{constructor(t,s){super(),this._line=B(this,t,t.add(s)),this.minVal=this._val=0,this.maxVal=1,this.reverse=!1}get p(){return this._line.p}set p(t){this._line.p=t}get sz(){return this._line.sz}set sz(t){this._line.sz=t}get val(){return r(_val)}set val(t){this._val=t}range(){return r(maxVal-minVal)}setRange(t,s){this.minVal=t.valueOf(),this.maxVal=s.valueOf()}_from01(t){return r(t).fromScale(this.minVal,this.maxVal)}_to01(t){return r(t).intoScale(this.minVal,this.maxVal)}_p2v(t){return this._from01((this.reverse?this._line.p2.sub(t):t.sub(this._line.p1)).lgt().div(this.sz.lgt()))}_v2p(t){return(this.reverse?this._line.p2:this._line.p1).add(this.sz.mul(this._to01(t).negate(this.reverse)))}}const tt=6,st="lightgrey";class et extends Z{constructor(t,s){super(t,s),this._line.width=tt,this._line.color=st,this._line.p2=t.add(s),this._thumb=function(t,s,e=null){return W(t,s,F,null,e||G)}(this,this._v2p(this._val)),this._thumb.movable(t=>(t=this._line.closeTo(t),this._thumb.p.ne(t)&&(this._valMoved=this._p2v(t)),t)),this._onVal=null,this.min=0,this.max=1}set min(t){this._min=t}set max(t){this._max=t}set color(t){this._thumb.fill=t}set _valMoved(t){t=this._toScale(t),super.val=t,this._onVal&&this._onVal(t)}set val(t){super.val=t,this._thumb.moveTo(this._v2p(this._fromScale(t))),this._onVal&&this._onVal(t)}split(t){t.front(this._line),t.back(this._thumb)}_toScale(t){return this._min+t*(this._max-this._min)}_fromScale(t){return(t-this._min)/(this._max-this._min)}set onVal(t){this._onVal=t}}function it(t,s,e){return t.front(new et(s,e))}const rt=new class{constructor(){this._dest=null}get ctx(){return this._ctx||(this._ctx=new AudioContext,(this._dest=new lt(1)).node.connect(this._ctx.destination)),this._ctx}get sr(){return this.ctx.sampleRate}get now(){return this.ctx.currentTime}get dest(){return this._dest}beep(t,s,e){const i=new ut;i.osc.cps=t,i.sendToDest(),i.start(),i.nowRamps(i.gai.node.gain,.3,e/3*2,0,e/3),i.deleteAfter(e)}testBeep(){rt.beep(880,.3,.12)}};!function(t,s){let e;(e=window.QM)||(e=window.QM={}),e[t]||(e[t]=s())}("Audio",()=>rt),rt.mute=(()=>{rt.dest&&rt.dest.node.gain.linearRampToValueAtTime(0,rt.now+.1)}),rt.after=((t,s)=>{setTimeout(()=>{s()},1e3*t)}),rt.sequence=((...t)=>{const s=()=>{if(t.length){const[e,i]=t.shift();setTimeout(()=>{i(),s()},1e3*e)}};s()}),window.addEventListener("beforeunload",()=>rt.mute());class nt{constructor(){this._state=0}inlet(){return null}outlet(){return null}start(t=0){return 0===this._state&&(this.nodeStart(t),this._state=1,!0)}stop(t=0){return 1===this._state&&(this.nodeStop(t),this._state=2,!0)}nodeStart(t){}nodeStop(t){}sendTo(t=null){const s=this.outlet();if(s&&(s.disconnect(),t)){const e=t.inlet();e&&s.connect(e)}}sendToDest(){this.sendTo(rt.dest)}deleteAfter(t){rt.after(t+.01,()=>{this.stop(),this.sendTo()})}rampLin(t,s,e=null,i=null,r=null){null==r&&(r=rt.now),null==e&&(e=r+.01),null!=i&&t.setValueAtTime(i,r),t.linearRampToValueAtTime(s,e)}rampExp(t,s,e=null,i=null,r=null){null==r&&(r=rt.now),null==e&&(e=r+.01),null!=i&&t.setValueAtTime(i,r),t.exponentialRampToValueAtTime(s<=0?1e-6:s,e),t.setValueAtTime(s,e)}ramp(t,s,e=null,i=null,r=null){s<(null!=i?i:t.value)?this.rampExp(t,s,e,i,r):this.rampLin(t,s,e,i,r)}ramps(t,s,...e){let i,r;for(;2<=e.length;){const n=e.shift(),h=e.shift()+s;this.ramp(t,n,h,i,r),i=n,r=h}}nowRamps(t,...s){this.ramps(t,rt.now,...s)}}class ht extends nt{constructor(t){super(),this._node=t}inlet(){return this._node}outlet(){return this._node}}const ot=t=>(class extends t{nodeStart(t){return this._node.start(t)}nodeStop(t){return this._node.stop(t)}});class at extends(ot(ht)){constructor(t="sine"){super(rt.ctx.createOscillator()),this.node.type=t,this.cps=0,this.phs=0}get node(){return this._node}get cps(){return this.node.frequency.value}set cps(t){this.node.frequency.value=t}set cpsRamp(t){this.ramp(this.node.frequency,t)}get phs(){return this._phs}set phs(t){this._phs=t}}class lt extends ht{constructor(t=0){super(rt.ctx.createGain()),this.amp=t}get node(){return this._node}get amp(){return this.node.gain.value}set amp(t){this.node.gain.value=t}set ampRamp(t){this.ramp(this.node.gain,t)}get amp2(){return Math.sqrt(this.amp)}set amp2(t){this.amp=t*t}set ampRamp2(t){this.ampRamp=t*t}}lt.soft=.3,lt.loud=.7,lt.full=1;class ut extends nt{constructor(t="sine",s=0,e=0){super(),this.osc=new at(t),this.gai=new lt(s),this.osc.sendTo(this.gai),this.pan=new ct(e),this.gai.sendTo(this.pan)}inlet(){return this.osc.node}outlet(){return this.pan.node}nodeStart(t){this.osc.nodeStart(t)}nodeStop(t){this.osc.nodeStop(t)}}class ct extends ht{constructor(t=0){super(rt.ctx.createStereoPanner()),this.pan=t}get node(){return this._node}get pan(){return this.node.pan.value}set pan(t){this.node.pan.value=t}set panRamp(t){this.ramp(this.node.pan,t)}left(){this.pan=-1}center(){this.pan=0}right(){this.pan=1}}class _t extends(ot(ht)){constructor(){super(rt.ctx.createBufferSource())}get node(){return this._node}nodeStart(t){this.node.start(t)}nodeStop(t){this.node.stop(t)}createBuffer(t,s){const e=rt.ctx.createBuffer(1,t,rt.sr),i=e.getChannelData(0);for(let e=0;e<t;++e)i[e]=s(e);this.node.buffer=e,this.node.loop=!0}}class dt extends _t{constructor(){super(),this.createBuffer(8*rt.sr,()=>2*Math.random()-1)}}class pt{constructor(){this._b0=0,this._b1=0,this._b2=0,this._b3=0,this._b4=0,this._b5=0,this._b6=0}nextSample(){const t=2*Math.random()-1;this._b0=.99886*this._b0+.0555179*t,this._b1=.99332*this._b1+.0750759*t,this._b2=.969*this._b2+.153852*t,this._b3=.8665*this._b3+.3104856*t,this._b4=.55*this._b4+.5329522*t,this._b5=-.7616*this._b5-.016898*t;const s=.22*(this._b0+this._b1+this._b2+this._b3+this._b4+this._b5+this._b6+.5362*t);return this._b6=.115926*t,s}}class gt extends _t{constructor(){super();const t=new pt;this.createBuffer(8*rt.sr,()=>t.nextSample())}}class mt{static tone(t,s,e="sine"){if(t._klang){const s=t._klang;delete t._klang,s.nowRamps(s.gai.node.gain,0,.33),s.deleteAfter(.3)}else{const i=new ut(e);i.sendToDest(),t._klang=i,i.osc.cps=s,i.start(),i.nowRamps(i.gai.node.gain,.4,.23)}}static _bufferKlang(t,s){if(t._klang){let[s,e]=t._klang;delete t._klang,s.nowRamps(s.node.gain,0,.23),s.deleteAfter(.3),e.deleteAfter(.3)}else{const e=new lt;e.sendToDest();const i=new s;i.sendTo(e),t._klang=[e,i],i.start(),e.nowRamps(e.node.gain,.2,.23)}}static whiteNoise(t){this._bufferKlang(t,dt)}static pinkNoise(t){this._bufferKlang(t,gt)}static noise(t,s){return"white"===s?this.whiteNoise(t):"pink"===s?this.pinkNoise(t):this.tone(t,0)}static sineTone(t=0){const s=new ut("sine",0,t);return s.sendToDest(),s.cps=(t=>s.osc.cpsRamp=t),s.amp=(t=>s.gai.ampRamp=t),s.start(),s}}window.app_sampling=function(t){const s=I(t),[e,i,r]=s.fbo();let[n,h,o,a,l,u,c,_]=s.msz(),d=s.m;h-=3*d,B(i,p(l,a),p(u,a),"darkgray").dashedStroke();let g,m,f=U(e);f.stroke="green",f.width=1.7,Y(i,p(l,c+16),"wave phase");let x=it(i,p(l,c),p(n/2-d,0));var v;x.val=-(m=-0),x.onVal=(t=>(t=-t,m=t,void z())),Y(i,p(o,c+16),"wavelength"),(x=it(i,p(o,c),p(n/2,0))).min=.05,x.val=1/(g=3),x.onVal=(t=>(function(t){g=t,z()})(1/t));let b,w,A=U(i);A.stroke="blue",A.width=2;let y,k=i.g;k.p=p(l,a),Y(i,p(o,_-8),"sampling"),(x=it(i,p(o,_),p(n/2,0))).min=36,x.max=1,x.val=y=6.1,x.onVal=(t=>(function(t){y=t,z()})(t));let $=(t,s)=>Math.abs(t-s)<.04,S=!1,M=mt.sineTone(-1),T=mt.sineTone(1);function z(){let t=g,s=y,e=f.ampl(0),i=S&&$(2*t/s,1)&&$(e,0),r=S&&!i&&$(t/s,1),o=a,u=a;i?t=s/2:r&&(t=s),f.set(t,m,p(n/t,h/2),p(l,o)),k.clear();for(let e=0;e<s;++e){let r=e/s*t,o=i?0:-f.ampl(r)*h/2,a=r*n/t;B(k,p(a,0),p(a,o),"red"),W(k,p(a,o),3).color="red"}let c=!!Math.floor(2*t/s%2);i||r?b=t:(b=t%s)>s/2&&(b=s-b),A.steady=i?0:r?e:null,w=c?.5-m:m,A.set(b,w,[n/b,h/2-1.7],[l,u]),M.cps(200*t),T.cps(200*b),T.amp(null==A.steady?N:0)}let E=r.controls();E.check("enhance singularities",t=>{S=t,z()});let N=0,P=E.br().range(0,1,0,()=>{N=P.value,M.amp(N),T.amp(null==A.steady?N:0)});z()}}]);