!function(t){var s={};function e(r){if(s[r])return s[r].exports;var i=s[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}e.m=t,e.c=s,e.d=function(t,s,r){e.o(t,s)||Object.defineProperty(t,s,{configurable:!1,enumerable:!0,get:r})},e.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},e.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(s,"a",s),s},e.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},e.p="",e(e.s=0)}([function(t,s,e){"use strict";function r(){r.made||(r.made=!0,Object.prototype.forAll=function(t){if(this instanceof Object)for(const s in this)this.hasOwnProperty(s)&&t(this[s],s);else t(this,0)},Array.prototype.forAll=function(t){this.forEach((s,e)=>t(s,e))},Array.prototype.insert=function(t,s){this.splice(t,0,s)})}function i(t=n.NaN){return t instanceof n?t:new n(t)}e.r(s);class n extends Number{constructor(t=n.NaN){super(t.valueOf())}$(t){return new this.constructor(t)}get isNaN(){return Number.isNaN(this.valueOf())}get isDef(){return!this.isNaN}get isPos(){return 0<this}get isNeg(){return 0>this}get is0(){return 0==this}get abs(){return this.$(Math.abs(this))}isNear(t){return 1e-8>this.sub(t).abs}add(t){return this.$(this+t)}sub(t){return this.$(this-t)}mul(t){return this.$(this*t)}div(t){return this.$(this/t)}neg(){return this.$(-this)}idv(t){return this.$(Math.floor(this/t))}mod(t){return this.$(this%t)}eq(t){return this.valueOf()==t}ne(t){return this.valueOf()!=t}lt(t){return this.valueOf()<t}le(t){return this.valueOf()<=t}gt(t){return this.valueOf()>t}ge(t){return this.valueOf()>=t}floor(){return this.$(Math.floor(this))}ceil(){return this.$(Math.ceil(this))}round(){return this.$(Math.round(this))}negate(t){return t?this.neg():this}norm(t,s){let e=this.valueOf();if(e<t||s<=e){const r=s-t;e-=t,e-=Math.floor(e/r)*r,(e+=t)>=s&&(e=t)}return this.$(e)}clamp(t,s){return this.$(Math.max(Math.min(this,s),t))}clamp01(){return this.clamp(0,1)}min(t){return this.$(Math.min(this,t))}max(t){return this.$(Math.max(this,t))}inv(){return this.$(this.is0?n.NaN:1/this)}sqrt(){return this.$(Math.sqrt(this))}log2(){return this.$(Math.log(this)*Math.LOG2E)}exp2(){return this.$(Math.exp(this/Math.LOG2E))}log10(){return this.$(Math.log(this)*Math.LOG10E)}exp10(){return this.$(Math.exp(this/Math.LOG10E))}pow(t){return this.$(Math.pow(this,t))}sin(){return this.$(Math.sin(this))}cos(){return this.$(Math.cos(this))}tan(){return this.$(Math.tan(this))}asin(){return this.$(Math.asin(this))}acos(){return this.$(Math.acos(this))}atan(){return this.$(Math.atan(this))}fromScale(t,s){return i(t+this*(s-t))}intoScale(t,s){return i((this-t)/(s-t))}scale(t,s,e,r){return this.intoScale(t,s).fromScale(e,r)}}function h(t=n.NaN){return new o(t)}n.rand=((t,s)=>i(t+Math.random()*(s-t)));class o extends n{toDeg(){return a(this/Math.PI*180)}}function a(t=n.NaN){return new l(t)}class l extends n{toRad(){return h(this*Math.PI/180)}sin(){return this.toRad().sin()}cos(){return this.toRad().cos()}tan(){return this.toRad().tan()}asin(){return h(super.asin()).toDeg()}acos(){return h(super.acos()).toDeg()}atan(){return h(super.atan()).toDeg()}}function u(t,s){return new _(t,s)}function c(){return u(0,0)}class _{constructor(t,s){0>t&&(t=-t,s+=180),this._r=t.valueOf(),this._a=i(s).norm(0,360).valueOf()}get r(){return i(this._r)}get a(){return a(this._a)}toString(){return`[${this.r}\\${this.a}]`}get is0(){return 0==this.r}isNear(t){return this.r.isNear(t.r)&&this.a.isNear(t.a)}add(t){return this.toXY().add(t.toXY()).toRA()}eq(t){return this._r==t.r&&this._a==t.a}toXY(){return p(this._r*this.a.cos(),this._r*this.a.sin())}}function d(t,s){return t instanceof f?t:Array.isArray(t)?f.fromArray(t):null==t?null:p(t,s)}function p(t,s){return new f(t,s)}function g(){return p(0,0)}function m(t){return p(t,t)}_._0=c(),_.fromArray=(t=>u(t[0],t[1]));class f{constructor(t,s){this._x=t.valueOf(),this._y=s.valueOf()}get x(){return i(this._x)}get y(){return i(this._y)}toString(){return`[${this._x}:${this._y}]`}toArray(){return[this.x,this.y]}_toSvg(){return`${this._x.toFixed(1)} ${this._y.toFixed(1)}`}get is0(){return this.eq(f._0)}isNear(t){return this.x.isNear(t.x)&&this.y.isNear(t.y)}add(t){return t instanceof f?p(this._x+t._x,this._y+t._y):p(this._x+t,this._y+t)}sub(t){return t instanceof f?p(this._x-t._x,this._y-t._y):p(this._x-t,this._y-t)}mul(t){return t instanceof f?p(this._x*t._x,this._y*t._y):p(this._x*t,this._y*t)}div(t){return t instanceof f?p(this._x/t._x,this._y/t._y):p(this._x/t,this._y/t)}neg(){return p(-this._x,-this._y)}mag(){return i(this._x*this._x+this._y*this._y)}lgt(){return this.mag().sqrt()}dot(t){return i(this._x*t.x+this._y*t.y)}cross(t){return i(this._x*t.y-this._y*t.x)}unit(){const t=this.lgt();return 0<t?this.div(t):p(1,0)}eq(t){return this._x==t.x&&this._y==t.y}ne(t){return!this.eq(t)}min(){return Math.min(this._x,this._y)}max(){return Math.max(this._x,this._y)}toRA(){const t=this.lgt();if(t.le(0))return c();const s=this.x,e=this.y;return u(t,s.isNear(0)?e.isNear(0)?0:e.isPos?90:270:a(e.div(s)).atan().add(s.isPos?0:180))}}f._0=g(),f.fromArray=(t=>p(t[0],t[1])),f.fromXY=(t=>p(t.x,t.y)),f.fromWH=(t=>p(t.width,t.height)),r();class x{constructor(t){this.el=x.elSel(t)}get isShown(){return!this.hasClass("hidden")}show(t=!0){this.toggleClass("hidden",!t)}hide(){this.show(!1)}get style(){return this.el.style}set width(t){this.style.width=`${t}px`}set height(t){this.style.height=`${t}px`}set color(t){this.style.color=t}set background(t){this.style.background=t}addClass(t){t.forAll(t=>this.el.classList.add(t))}remClass(t){t.forAll(t=>this.el.classList.remove(t))}toggleClass(t,s){t.forAll(t=>this.el.classList.toggle(t,s))}hasClass(t){return this.el.classList.contains(t)}get sz(){return p(this.el.clientWidth,this.el.clientHeight)}set sz(t){this.width=t.x,this.height=t.y}get bsz(){return f.fromWH(this.el.getBoundingClientRect())}}x.elSel=(t=>t instanceof Element?t:t instanceof x?t.el:document.querySelector(t));class v extends x{constructor(t,s=null){super(t),this._onWindowResize=null,s&&(this.sz=s),this._resizeEvent(),window.addEventListener("resize",this._resizeEvent)}get minSize(){return 0}_resizeEvent(){this._onWindowResize&&this._onWindowResize(p(window.innerWidth,window.innerHeight))}set onWindowResize(t){this._onWindowResize=t,this._resizeEvent()}availableRectangle(){const t=this.el.parentElement;return p(t.clientWidth,t.clientHeight)}}function A(t,s){return new y(t,s)}function w(){return A(f._0,f._0)}class y{constructor(t,s){this.tr=d(t),this.sc=d(s)}toString(){return`(${this.tr}/${this.sc})`}get is0(){return this.tr.is0&&this.sc.is0}isNear(t){return this.tr.isNear(t.tr)&&this.sc.isNear(t.sc)}eq(t){return this.tr.eq(t.tr)&&this.sc.eq(t.sc)}svgString(){let t="";return this.tr.is0||(t+=`translate(${this.tr.x} ${this.tr.y}) `),this.sc.is0||(t+=`scale(${this.sc.x} ${this.sc.y})`),t}add(t){return A(this.tr.add(t.tr),this.sc.add(t.sc))}}y._0=w();class b{}b.navigator=window.navigator,b.userAgent=b.navigator.userAgent,b.isChrome=!!b.userAgent.match("Chrome"),b.isFF=!!b.userAgent.match("Firefox"),b.isSafari=!b.isChrome&&!!b.userAgent.match("Safari"),b.isIOS=!!b.userAgent.match("iPad|iPhone|iPod"),b.alert=(t=>window.alert(t.toString())),b.touchPoints=b.isIOS?1:b.navigator.maxTouchPoints?b.navigator.maxTouchPoints:0,b.isTouch=b.touchPoints>0,b.oneStream=((t,s,e,r)=>t.addEventListener(b.isTouch?e:s,r)),r();class ${constructor(){this.group=null,this.scene=null,this.el=null,this._sceneNodeAttrs()}_setScene(t){this.scene=t}_setGroup(t){this.group=t,this._setScene(t.scene)}getAttr(t){return this.el.getAttribute(t)}setAttr(t,s){s?this.el.setAttribute(t,s):this.el.removeAttribute(t)}setAttrs(t){t.forAll((t,s)=>this.setAttr(s,t))}isShown(){return"none"!=this.getAttr("display")}show(t=!0){this.setAttr("display",t?"":"none")}hide(){this.show(!1)}set stroke(t){this.setAttr("stroke",t)}get stroke(){return this.getAttr("stroke")}set fill(t){this.setAttr("fill",t)}get fill(){this.getAttr("fill")}set color(t){this.stroke=t,this.fill=t}set width(t){this.setAttr("stroke-width",t)}set lineCap(t){this.setAttr("stroke-linecap",t)}set lineJoin(t){this.setAttr("stroke-linejoin",t)}set dashArray(t){this.setAttr("stroke-dasharray",t)}solidStroke(t=null){this.dashArray=null,t&&(this.stroke=t)}dottedStroke(t=null){this.dashArray="1,3",t&&(this.stroke=t)}dashedStroke(t=null){this.dashArray="3,2",t&&(this.stroke=t)}$attrs(){this._sceneNodeAttrs()}_sceneNodeAttrs(){}}class k extends ${constructor(){super(),this.nodes=[],this._trf=w(),this.el=T.elem("g"),this._bg=null,this._fg=null,this._groupNodeAttrs()}_setScene(t){super._setScene(t),this.nodes.forAll(s=>s._setScene(t))}isRoot(){return null==this.group}isEmpty(){return!!this.nodes.length}back(t){return this.nodes.length?(this.nodes.unshift(t),this.el.insertBefore(t.el,this.el.firstChild),t._setGroup(this),t):this.front(t)}front(t){return this.nodes.push(t),this.el.appendChild(t.el),t._setGroup(this),t}clear(){let t;for(this.nodes=[];t=this.el.firstChild;)this.el.removeChild(t)}get g(){return this.front(new k)}get bg(){return this._bg?this._bg:this._bg=this.back(new k)}get fg(){return this._fg?this._fg:this._fg=this.front(new k)}get trf(){return this._trf}set trf(t){this._trf=t,this._attrTR()}get p(){return this._trf.tr}set p(t){this.trf=A(t,this.trf.sc)}get gp(){return null==this.group?this.p:this.parent.p.add(this.p)}set sc(t){this.trf=A(this.trf.tr,t)}$attrs(){super.$attrs(),this._groupNodeAttrs()}_attrTR(){this.setAttr("transform",this._trf.svgString())}_groupNodeAttrs(){this._attrTR()}}class S extends k{constructor(){super(),this.labels=[]}centerLabels(){this.labels.forAll(t=>t.center())}}class M extends S{constructor(t){super(),this.container=t,this.scene=this,this.el=t.innerElem,this._lastPointerPos=g(),this.offX=0,this.offY=0,this.cursor=null,this._sceneAttrs()}interactive(){function t(t){return p(t.clientX,t.clientY)}let s;b.oneStream(this.el,"mousedown","touchstart",e=>{this._mn&&(s=this._mn.p.sub(t(e)))}),b.oneStream(this.el,"mousemove","touchmove",e=>{e.preventDefault(),this._mn&&this._mn.moveTo(s.add(t(e)),!0)}),b.oneStream(this.el,"mouseup","touchend",t=>{this._mn=null}),this._mn=null}_move(t){this._mn=t}$attrs(){super.$attrs(),this._sceneAttrs()}_sceneAttrs(){this.stroke="black",this.fill="none",this.width=1,this.lineCap="round"}}class P extends v{constructor(t,s,e=null){super(t,e),this.el.append(this.innerElem=s),this.style.position="relative";const r=s.style;r.position="absolute",r.width="100%",r.height="100%",this.scene=new M(this)}get minSize(){return 32}get bg(){return this.scene.bg}get fg(){return this.scene.fg}setMouse(t){this.el.addEventListener("mousedown",()=>{this._isMouseDown=!0}),this.el.addEventListener("mouseup",()=>{this._isMouseDown=!1}),this.el.addEventListener("mousemove",s=>{this._isMouseDown&&s.preventDefault(),t(p(s.offsetX,s.offsetY))})}}class T extends P{constructor(t,s=null){super(t,T.elem("svg"),s)}get svgElem(){return this.innerElem}}T.elem=(t=>document.createElementNS("http://www.w3.org/2000/svg",t)),T.div=((t=null)=>{const s=(t,s=null)=>{const e=document.createElement(t);return s&&e.classList.add(s),e},e=s("div",t),r=(t,r=null)=>e.appendChild(s(t,r));return e.br=(()=>(e.appendChild(s("br")),e)),e.label=(t=>{const s=r("label");return s.innerText=t,s}),e.input=(t=>{const s=r("input");return s.type=t,s}),e.radio=((t,s=null,r=null)=>{let i=e.input("radio");return t&&(i.name=t),s&&e.label(s),r&&(i.onclick=r),i.check=(()=>i.checked=!0),i}),e.button=((t,s=!1,e=null)=>{const i=r("button");return i.innerText=t,s&&(i.classList.add("toggle"),i.toggle=(()=>i.classList.toggle("down"))),e&&(i.onclick=e),i}),e.check=((t=null,s=!1)=>{let r=e.input("checkbox");return t&&e.label(t),s&&(r.onchange=(()=>s(r.checked))),r.check=(()=>r.checked=!0),r}),e.range=((t,s,r,i)=>{const n=e.input("range");return n.min=t,n.max=s,n.step=r>0?r:(s-t)/60,n.value=t,n.oninput=i,n}),e});class z extends ${constructor(){super()}get p(){return g()}set p(t){}get sz(){return g()}set cursor(t){this.setAttr("cursor",t)}get cursor(){return this.getAttr("cursor")}movable(t=null,s=null){this.cursor="pointer",this._onMove=t,b.oneStream(this.el,"mousedown","touchstart",t=>{s&&s(this.p,this),this.scene._move(this)})}moveTo(t,s=!1){if(t=d(t),!this._isMoving){if(this._isMoving=!0,this._onMove){const e=this._onMove(t,this,s);e&&(t=e)}this.p=t,delete this._isMoving}}set markerBeg(t){this.setAttr("marker-start",t)}set markerEnd(t){this.setAttr("marker-end",t)}arrowBeg(){this.markerBeg="url(#arrowBeg)"}arrowEnd(){this.markerEnd="url(#arrowEnd)"}}class E extends z{constructor(t){super(),this._p=d(t)}get p(){return this._p}set p(t){this._p=d(t),this._attrP()}_attrP(){}$attrs(){super.$attrs(),this._attrP()}}class N extends E{constructor(t,s){super(t),this._r=s}get r(){return this._r}set r(t){this._r=t,this._attrR()}_attrR(){}$attrs(){super.$attrs(),this._attrR()}set(t,s){this.p=t,this.r=s}}class O extends z{constructor(t,s){super(),this._p1=d(t),this._p2=d(s)}get p(){return this._p1}set p(t){t=d(t),this._p2=this._p2.add(t.sub(this._p1)),this._p1=t,this._attrP1(),this._attrP2()}get p1(){return this._p1}set p1(t){this._p1=d(t),this._attrP1()}get p2(){return this._p2}set p2(t){this._p2=d(t),this._attrP2()}get sz(){return this._p2.sub(this._p1)}set sz(t){this._p2=this._p1.add(d(t)),this.$attrP2()}set(t,s){this._p1=d(t),this._p2=d(s),this._attrP1(),this._attrP2()}ctr(){return this._p1.add(p2).div(2)}lgt(){return this._p2.sub(this._p1).lgt()}_attrP1(){}_attrP2(){}$attrs(){super.$attrs(),this._attrP1(),this._attrP2()}}class R extends z{constructor(t){super(),this._ps=t,this._sc=m(1),this._tr=g()}get p(){return this._ps.isEmpty?g():this._ps.first}set p(t){if(t=d(t),this._ps.isEmpty)return;const s=t.sub(this._ps.first);this._ps=this._ps.map(t=>t.add(s)),this._attrD()}get ps(){return this._ps}set ps(t){this._ps=t,this._attrD()}get sc(){return this._sc}set sc(t){this._sc=d(t),this._attrD()}get tr(){return this._tr}set tr(t){this._tr=d(t),this._attrD()}set(t,s=null,e=null){this._ps=t,s&&(this.sc=s),e&&(this.tr=e),this._attrD()}get trans(){let t=this._ps;return this._sc&&(t=t.map(t=>t.mul(this._sc))),this._tr&&(t=t.map(t=>t.add(this._tr))),t}_attrD(){}$attrs(){super.$attrs(),this._attrD()}}class C extends ${constructor(t){super(),this.el=T.elem("marker"),this.el.id=t}}class V extends C{constructor(t){super(t),this.setAttr("markerUnits","strokeWidth"),this.setAttr("markerWidth","5"),this.setAttr("markerHeight","4"),this.setAttr("orient","auto"),this.setAttr("viewBox","0 0 10 10"),this.setAttr("fill","black"),this.setAttr("refX","5"),this.setAttr("refY","5");const s=new H;s.setAttr("d","M 10 0 L 0 5 L 10 10 z"),this.el.appendChild(s.el)}}class D extends C{constructor(t){super(t),this.setAttr("markerUnits","strokeWidth"),this.setAttr("markerWidth","5"),this.setAttr("markerHeight","4"),this.setAttr("orient","auto"),this.setAttr("viewBox","0 0 10 10"),this.setAttr("fill","black"),this.setAttr("refX","5"),this.setAttr("refY","5");const s=new H;s.setAttr("d","M 0 0 L 10 5 L 0 10 z"),this.el.appendChild(s.el)}}class L extends O{constructor(t,s){super(t,s),this.el=T.elem("line"),this._lineAttrs()}closeTo(t){const s=this._p2.sub(this._p1),e=d(t).sub(this._p1),r=s.dot(e).div(s.mag()).clamp01();return this._p1.add(s.mul(r))}_attrP1(){this.setAttr("x1",this._p1.x),this.setAttr("y1",this._p1.y)}_attrP2(){this.setAttr("x2",this._p2.x),this.setAttr("y2",this._p2.y)}_lineAttrs(){this._attrP1(),this._attrP2()}$attrs(){super.$attrs(),this._lineAttrs()}}function B(t,s,e,r=null,i=null){const n=new L(s,e);return n.stroke=r,n.fill=i,t.front(n)}class q extends N{constructor(t,s){super(t,s),this.el=T.elem("circle"),this._circleAttrs()}get sz(){return m(2*this._r)}closeTo(t){return this._p.add(d(t).sub(this._p).unit().mul(this._r))}atr(t){return p(this._p.x.add(this._r.mul(a(t).cos())),this._p.y.sub(this._r.mul(a(t).sin())))}atp(t){let s=-a((t=this.closeTo(d(t)).sub(this._p).div(this._r)).y).asin();return 0>t.x&&(s=180-s),0>s&&(s+=360),s}_attrP(){this.setAttr("cx",this._p.x),this.setAttr("cy",this._p.y)}_attrR(){this.setAttr("r",this._r)}_circleAttrs(){this._attrP(),this._attrR()}$attrs(){super.$attrs(),this._circleAttrs()}}function W(t,s,e,r=null,i=null){const n=new q(s,e);return n.stroke=r,n.fill=i,t.front(n)}const F=b.isTouch?9:6,G="yellow";class X extends E{constructor(t,s,e=null,r=null){super(t),this._s=s,this._size=e,this._font=r,this.el=T.elem("text"),this._labelAttrs()}center(){const t=this.el.getBBox();this.p=this.p.sub(p(t.width/2,-t.height/4))}leftBelow(){const t=this.el.getBBox();this.p=this.p.sub(p(t.width,-t.height))}get s(){return this._s}set s(t){this._s=t,this._attrText()}get font(){return this._font}set font(t){this._font=t,this._attrFont()}get size(){return this._size}set size(t){this._size=t,this._attrSize()}_attrP(){this.setAttr("x",this._p.x),this.setAttr("y",this._p.y)}_attrFont(){this.setAttr("font-family",this._font)}_attrSize(){this.setAttr("font-size",this._size)}_attrText(){this.el.textContent=this._s}_labelAttrs(){this.setAttr("x",this._p.x),this.setAttr("y",this._p.y),this._attrFont(),this._attrSize(),this._attrText()}$attrs(){super.$attrs(),this._labelAttrs()}}function Y(t,s,e,r="black",i="none"){let n=new X(s,e);return n.fill=r,n.stroke=i,n=t.front(n),t instanceof S&&t.labels.push(n),n}class H extends R{constructor(t=null){super(null==t?[]:t),this.el=T.elem("path"),this._pathAttrs()}_seg(t){return t.x.toFixed(1)+","+t.y.toFixed(1)+" "}_d(){let t="";if(this._ps.length>0){const s=this.trans;t+="M"+this._seg(s.first);for(let e in s.skip(1))t+="L"+this._seg(e)}return t}_attrD(){this.setAttr("d",this._d())}_pathAttrs(){this._attrD()}$attrs(){super.$attrs(),this._pathAttrs()}}class j extends H{constructor(t=!0,s=null){super(s),this._stripEnds=t}_bezier(){const t=this._stripEnds?1:0,s=this._ps.length;if(s<3+2*t)return"";const e=this.trans;let r=e[0],i=e[0+t],n=e[1+t],h=e[2+t],o="M"+this._seg(i);for(let a=6,l=2+t;;){let u=n.sub(r).div(a),c=h.sub(i).div(a);if(o+="C"+this._seg(i.add(u))+this._seg(n.sub(c))+this._seg(n),++l>s-t)break;r=i,i=n,n=h,h=e[l<s?l:l-1]}return o}_d(){return this._bezier()}}const I=function(t,s=2){let e=new v(t).availableRectangle();s&&(e=p(e.x,e.x/s));let r=new U(t,e);return r._arrowBegEnd(),r};class U extends T{constructor(t,s=null){super(t,s),this.scene.interactive(),this.addClass("quint"),b.isTouch&&this.addClass("touch");const e=this.overDiv=T.div("overlay");this.el.appendChild(e),e.controls=(()=>(e._controls||e.appendChild(e._controls=T.div("controls")),e._controls)),e.centerAt=((t,s)=>{let e=t.style;e.position="absolute",e.left=s.x-t.clientWidth/2+"px",e.top=s.y-t.clientHeight/2+"px"}),this._margin=0}fbo(){return[this.fg,this.bg,this.overDiv]}_arrowBegEnd(){this._arrowBeg||this.svgElem.append((this._arrowBeg=new V("arrowBeg")).el),this._arrowEnd||this.svgElem.append((this._arrowEnd=new D("arrowEnd")).el)}get m(){return i(this._margin)}msz(t=14){this._margin=t=t.valueOf();const s=super.sz,e=s.x,r=s.y,n=t,h=e-t,o=t,a=r-t;return[i(h-n),i(a-o),i(e/2),i(r/2),i(n),i(h),i(o),i(a)]}radialGradient(t,s,e){let r;for(void 0==this._defs&&this.innerElem.append(this._defs=T.elem("defs")),void 0==this._rg&&(this._defs.append(this._rg=T.elem("radialGradient")),this._rg.id=t);r=this._rg.firstChild;)this._rg.removeChild(r);for(var i=0;i<s.length;++i){var n=T.elem("stop");this._rg.append(n),n.setAttribute("offset",s[i]),n.setAttribute("stop-color",e[i])}}}class J extends j{constructor(){super(),this.ph=null,this.steady=null,this.set()}ampl(t,s=null){return null!=this.steady?this.steady:(null==s&&(s=this.ph),a(360*(t+s)).sin())}set(t=0,s=0,e=null,r=null){this.cycles=t.valueOf(),this.ph=s.valueOf(),this._setPath(e,r)}_setPath(t,s){let e=[];const r=this.cycles;if(r){const t=Math.ceil(12*r);for(let s=-1;s<=t+1;++s){let i=s/t*r;e.push(p(i,-this.ampl(i)))}}super.set(e,t,s)}}function K(t){return t.front(new J)}class Q extends k{constructor(){super()}}class Z extends Q{constructor(t,s){super(),this._line=B(this,t,t.add(s)),this.minVal=this._val=0,this.maxVal=1,this.reverse=!1}get p(){return this._line.p}set p(t){this._line.p=t}get sz(){return this._line.sz}set sz(t){this._line.sz=t}get val(){return i(_val)}set val(t){this._val=t}range(){return i(maxVal-minVal)}setRange(t,s){this.minVal=t.valueOf(),this.maxVal=s.valueOf()}_from01(t){return i(t).fromScale(this.minVal,this.maxVal)}_to01(t){return i(t).intoScale(this.minVal,this.maxVal)}_p2v(t){return this._from01((this.reverse?this._line.p2.sub(t):t.sub(this._line.p1)).lgt().div(this.sz.lgt()))}_v2p(t){return(this.reverse?this._line.p2:this._line.p1).add(this.sz.mul(this._to01(t).negate(this.reverse)))}}const tt=6,st="lightgrey";class et extends Z{constructor(t,s){super(t,s),this._line.width=tt,this._line.color=st,this._line.p2=t.add(s),this._thumb=function(t,s,e=null){return W(t,s,F,null,e||G)}(this,this._v2p(this._val)),this._thumb.movable(t=>(t=this._line.closeTo(t),this._thumb.p.ne(t)&&(this._valMoved=this._p2v(t)),t)),this._onVal=null,this.min=0,this.max=1}set min(t){this._min=t}set max(t){this._max=t}set color(t){this._thumb.fill=t}set _valMoved(t){t=this._toScale(t),super.val=t,this._onVal&&this._onVal(t)}set val(t){super.val=t,this._thumb.moveTo(this._v2p(this._fromScale(t))),this._onVal&&this._onVal(t)}split(t){t.front(this._line),t.back(this._thumb)}_toScale(t){return this._min+t*(this._max-this._min)}_fromScale(t){return(t-this._min)/(this._max-this._min)}set onVal(t){this._onVal=t}}function rt(t,s,e){return t.front(new et(s,e))}const it=new class{constructor(){this._dest=null}get ctx(){return this._ctx||(this._ctx=new AudioContext,(this._dest=new lt(1)).node.connect(this._ctx.destination)),this._ctx}get sr(){return this.ctx.sampleRate}get now(){return this.ctx.currentTime}get dest(){return this._dest}beep(t,s,e){const r=new ut;r.osc.cps=t,r.sendToDest(),r.start(),r.nowRamps(r.gai.node.gain,.3,e/3*2,0,e/3),r.deleteAfter(e)}testBeep(){it.beep(880,.3,.12)}};it.mute=(()=>{it.dest&&it.dest.node.gain.linearRampToValueAtTime(0,it.now+.1)}),it.after=((t,s)=>{setTimeout(()=>{s()},1e3*t)}),it.sequence=((...t)=>{const s=()=>{if(t.length){const[e,r]=t.shift();setTimeout(()=>{r(),s()},1e3*e)}};s()}),window.addEventListener("beforeunload",()=>it.mute());class nt{constructor(){this._startState=0}inlet(){return null}outlet(){return null}start(t=0){return 0===this._startState&&(this.nodeStart(t),this._startState=1,!0)}stop(t=0){return 1===this._startState&&(this.nodeStop(t),this._startState=2,!0)}nodeStart(t){}nodeStop(t){}sendTo(t=null){const s=this.outlet();if(s&&(s.disconnect(),t)){const e=t.inlet();e&&s.connect(e)}}sendToDest(){this.sendTo(it.dest)}deleteAfter(t){it.after(t+.01,()=>{this.stop(),this.sendTo()})}static _ramp(t,s,e,r,i,n){if(null==n&&(n=it.now),null==r&&(r=n+.01),t.cancelScheduledValues(n),null!=i&&t.setValueAtTime(i,n),s){const s=0>=e;t.exponentialRampToValueAtTime(s?1e-4:e,r),s&&t.setValueAtTime(e,r)}else t.linearRampToValueAtTime(e,r)}rampLin(t,s,e,r,i){this.constructor._ramp(t,!1,s,e,r,i)}rampExp(t,s,e,r,i){this.constructor._ramp(t,!0,s,e,r,i)}ramp(t,s,e,r,i){const n=null!=r?r:t.value;this.constructor._ramp(t,s<n,s,e,r,i)}ramps(t,s,...e){let r,i;for(;2<=e.length;){const n=e.shift(),h=e.shift()+s;this.ramp(t,n,h,r,i),r=n,i=h}}nowRamps(t,...s){this.ramps(t,it.now,...s)}}class ht extends nt{constructor(t){super(),this._node=t}inlet(){return this._node}outlet(){return this._node}}const ot=t=>(class extends t{nodeStart(t){return this._node.start(t)}nodeStop(t){return this._node.stop(t)}});class at extends(ot(ht)){constructor(t="sine"){super(it.ctx.createOscillator()),this.node.type=t,this.cps=0,this.phs=0}get node(){return this._node}get cps(){return this.node.frequency.value}set cps(t){this.ramp(this.node.frequency,t)}get phs(){return this._phs}set phs(t){if(this._phs=t,"sine"!==this.node.type)return;const s=this.node;if(s){const e=u(1,t).toXY(),r=it.ctx.createPeriodicWave(new Float32Array([0,e.x]),new Float32Array([0,e.y]));s.setPeriodicWave(r)}}}class lt extends ht{constructor(t=0){super(it.ctx.createGain()),this.ramp(this.node.gain,t)}get node(){return this._node}get amp(){return this.node.gain.value}set amp(t){this.ramp(this.node.gain,t)}get amp2(){return Math.sqrt(this.amp)}set amp2(t){this.amp=t*t}}lt.soft=.3,lt.loud=.7,lt.full=1;class ut extends nt{constructor(t="sine",s=0,e=0){super(),this.osc=new at(t),this.gai=new lt(s),this.osc.sendTo(this.gai),this.pan=new ct(e),this.gai.sendTo(this.pan)}inlet(){return this.osc.node}outlet(){return this.pan.node}nodeStart(t){this.osc.nodeStart(t)}nodeStop(t){this.osc.nodeStop(t)}}class ct extends ht{constructor(t=0){super(it.ctx.createStereoPanner()),this.pan=t}get node(){return this._node}get pan(){return this.node.pan.value}set pan(t){this.ramp(this.node.pan,t)}left(){this.pan=-1}center(){this.pan=0}right(){this.pan=1}}class _t{static tone(t,s,e="sine"){if(t._klang){const s=t._klang;delete t._klang,s.nowRamps(s.gai.node.gain,0,.23),s.deleteAfter(.3)}else{const r=new ut(e);r.sendToDest(),t._klang=r,r.osc.cps=s,r.start(),r.nowRamps(r.gai.node.gain,.2,.23)}}static sineTone(t=0){const s=new ut("sine",0,t);return s.sendToDest(),s.cps=(t=>s.osc.cps=t),s.amp=(t=>s.gai.amp=t),s.start(),s}}window.app_sampling=function(t){const s=I(t),[e,r,i]=s.fbo();let[n,h,o,a,l,u,c,_]=s.msz(),d=s.m;h-=3*d,B(r,p(l,a),p(u,a),"darkgray").dashedStroke();let g,m,f=K(e);f.stroke="green",f.width=1.7,Y(r,p(l,c+16),"wave phase");let x=rt(r,p(l,c),p(n/2-d,0));var v;x.val=-(m=-0),x.onVal=(t=>(t=-t,m=t,void T())),Y(r,p(o,c+16),"wavelength"),(x=rt(r,p(o,c),p(n/2,0))).min=.05,x.val=1/(g=3),x.onVal=(t=>(function(t){g=t,T()})(1/t));let A,w,y=K(r);y.stroke="blue",y.width=2;let b,$=r.g;$.p=p(l,a),Y(r,p(o,_-8),"sampling"),(x=rt(r,p(o,_),p(n/2,0))).min=36,x.max=1,x.val=b=6.1,x.onVal=(t=>(function(t){b=t,T()})(t));let k=(t,s)=>Math.abs(t-s)<.04,S=!1,M=_t.sineTone(-1),P=_t.sineTone(1);function T(){let t=g,s=b,e=f.ampl(0),r=S&&k(2*t/s,1)&&k(e,0),i=S&&!r&&k(t/s,1),o=a,u=a;r?t=s/2:i&&(t=s),f.set(t,m,p(n/t,h/2),p(l,o)),$.clear();for(let e=0;e<s;++e){let i=e/s*t,o=r?0:-f.ampl(i)*h/2,a=i*n/t;B($,p(a,0),p(a,o),"red"),W($,p(a,o),3).color="red"}let c=!!Math.floor(2*t/s%2);r||i?A=t:(A=t%s)>s/2&&(A=s-A),y.steady=r?0:i?e:null,w=c?.5-m:m,y.set(A,w,[n/A,h/2-1.7],[l,u]),M.cps(200*t),P.cps(200*A),P.amp(null==y.steady?E:0)}let z=i.controls();z.check("enhance singularities",t=>{S=t,T()});let E=0,N=z.br().range(0,1,0,()=>{E=N.value,M.amp(E),P.amp(null==y.steady?E:0)});T()}}]);