!function(t){var e={};function s(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=e,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},s.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";function n(t=r.NaN){return t instanceof r?t:new r(t)}s.r(e);class r extends Number{constructor(t=r.NaN){super(t.valueOf())}$(t){return new this.constructor(t)}get isNaN(){return Number.isNaN(this.valueOf())}get isDef(){return!this.isNaN}get isPos(){return 0<this}get isNeg(){return 0>this}get is0(){return 0==this}get abs(){return this.$(Math.abs(this))}isNear(t){return 1e-8>this.sub(t).abs}add(t){return this.$(this+t)}sub(t){return this.$(this-t)}mul(t){return this.$(this*t)}div(t){return this.$(this/t)}neg(){return this.$(-this)}idv(t){return this.$(Math.floor(this/t))}mod(t){return this.$(this%t)}eq(t){return this.valueOf()==t}ne(t){return this.valueOf()!=t}lt(t){return this.valueOf()<t}le(t){return this.valueOf()<=t}gt(t){return this.valueOf()>t}ge(t){return this.valueOf()>=t}floor(){return this.$(Math.floor(this))}ceil(){return this.$(Math.ceil(this))}round(){return this.$(Math.round(this))}negate(t){return t?this.neg():this}norm(t,e){let s=this.valueOf();if(s<t||e<=s){const n=e-t;s-=t,s-=Math.floor(s/n)*n,(s+=t)>=e&&(s=t)}return this.$(s)}clamp(t,e){return this.$(Math.max(Math.min(this,e),t))}clamp01(){return this.clamp(0,1)}min(t){return this.$(Math.min(this,t))}max(t){return this.$(Math.max(this,t))}inv(){return this.$(this.is0?r.NaN:1/this)}sqrt(){return this.$(Math.sqrt(this))}log2(){return this.$(Math.log(this)*Math.LOG2E)}exp2(){return this.$(Math.exp(this/Math.LOG2E))}log10(){return this.$(Math.log(this)*Math.LOG10E)}exp10(){return this.$(Math.exp(this/Math.LOG10E))}pow(t){return this.$(Math.pow(this,t))}sin(){return this.$(Math.sin(this))}cos(){return this.$(Math.cos(this))}tan(){return this.$(Math.tan(this))}asin(){return this.$(Math.asin(this))}acos(){return this.$(Math.acos(this))}atan(){return this.$(Math.atan(this))}fromScale(t,e){return n(t+this*(e-t))}intoScale(t,e){return n((this-t)/(e-t))}scale(t,e,s,n){return this.intoScale(t,e).fromScale(s,n)}}function i(t=r.NaN){return new h(t)}r.rand=((t,e)=>n(t+Math.random()*(e-t)));class h extends r{toDeg(){return a(this/Math.PI*180)}}function a(t=r.NaN){return new o(t)}class o extends r{toRad(){return i(this*Math.PI/180)}sin(){return this.toRad().sin()}cos(){return this.toRad().cos()}tan(){return this.toRad().tan()}asin(){return i(super.asin()).toDeg()}acos(){return i(super.acos()).toDeg()}atan(){return i(super.atan()).toDeg()}}function u(t,e){return new c(t,e)}class c{constructor(t,e){this._x=t.valueOf(),this._y=e.valueOf()}get x(){return n(this._x)}get y(){return n(this._y)}toString(){return`[${this._x}:${this._y}]`}toArray(){return[this.x,this.y]}_toSvg(){return`${this._x.toFixed(1)} ${this._y.toFixed(1)}`}get is0(){return this.eq(c._0)}isNear(t){return this.x.isNear(t.x)&&this.y.isNear(t.y)}add(t){return t instanceof c?u(this._x+t._x,this._y+t._y):u(this._x+t,this._y+t)}sub(t){return t instanceof c?u(this._x-t._x,this._y-t._y):u(this._x-t,this._y-t)}mul(t){return t instanceof c?u(this._x*t._x,this._y*t._y):u(this._x*t,this._y*t)}div(t){return t instanceof c?u(this._x/t._x,this._y/t._y):u(this._x/t,this._y/t)}neg(){return u(-this._x,-this._y)}mag(){return n(this._x*this._x+this._y*this._y)}lgt(){return this.mag().sqrt()}dot(t){return n(this._x*t.x+this._y*t.y)}cross(t){return n(this._x*t.y-this._y*t.x)}unit(){const t=this.lgt();return 0<t?this.div(t):u(1,0)}eq(t){return this._x==t.x&&this._y==t.y}ne(t){return!this.eq(t)}min(){return Math.min(this._x,this._y)}max(){return Math.max(this._x,this._y)}toRA(){const t=this.lgt();if(t.le(0))return d();const e=this.x,s=this.y;return l(t,e.isNear(0)?s.isNear(0)?0:s.isPos?90:270:a(s.div(e)).atan().add(e.isPos?0:180))}}function l(t,e){return new _(t,e)}function d(){return l(0,0)}c._0=u(0,0),c.fromArray=(t=>u(t[0],t[1])),c.fromXY=(t=>u(t.x,t.y)),c.fromWH=(t=>u(t.width,t.height));class _{constructor(t,e){0>t&&(t=-t,e+=180),this._r=t.valueOf(),this._a=n(e).norm(0,360).valueOf()}get r(){return n(this._r)}get a(){return a(this._a)}toString(){return`[${this.r}\\${this.a}]`}get is0(){return 0==this.r}isNear(t){return this.r.isNear(t.r)&&this.a.isNear(t.a)}add(t){return this.toXY().add(t.toXY()).toRA()}eq(t){return this._r==t.r&&this._a==t.a}toXY(){return u(this._r*this.a.cos(),this._r*this.a.sin())}}function p(t,e){let s;(s=window.QM)||(s=window.QM={}),s[t]||(s[t]=e())}_._0=d(),_.fromArray=(t=>l(t[0],t[1]));const f=new class{constructor(){this._dest=null}get ctx(){return this._ctx||(this._ctx=new AudioContext,(this._dest=new y(1)).node.connect(this._ctx.destination)),this._ctx}get sr(){return this.ctx.sampleRate}get now(){return this.ctx.currentTime}get dest(){return this._dest}beep(t,e,s){const n=new w;n.osc.cps=t,n.sendToDest(),n.start(),n.nowRamps(n.gai.node.gain,.3,s/3*2,0,s/3),n.deleteAfter(s)}testBeep(){f.beep(880,.3,.12)}};p("Audio",()=>f),f.mute=(()=>{f.dest&&f.dest.node.gain.linearRampToValueAtTime(0,f.now+.1)}),f.after=((t,e)=>{setTimeout(()=>{e()},1e3*t)}),f.sequence=((...t)=>{const e=()=>{if(t.length){const[s,n]=t.shift();setTimeout(()=>{n(),e()},1e3*s)}};e()}),window.addEventListener("beforeunload",()=>f.mute());class g{constructor(){this._startState=0}inlet(){return null}outlet(){return null}start(t=0){return 0===this._startState&&(this.nodeStart(t),this._startState=1,!0)}stop(t=0){return 1===this._startState&&(this.nodeStop(t),this._startState=2,!0)}nodeStart(t){}nodeStop(t){}sendTo(t=null){const e=this.outlet();if(e&&(e.disconnect(),t)){const s=t.inlet();s&&e.connect(s)}}sendToDest(){this.sendTo(f.dest)}deleteAfter(t){f.after(t+.01,()=>{this.stop(),this.sendTo()})}rampLin(t,e,s=null,n=null,r=null){null==r&&(r=f.now),null==s&&(s=r+.01),null!=n&&t.setValueAtTime(n,r),t.linearRampToValueAtTime(e,s)}rampExp(t,e,s=null,n=null,r=null){null==r&&(r=f.now),null==s&&(s=r+.01),null!=n&&t.setValueAtTime(n,r),t.exponentialRampToValueAtTime(e<=0?1e-6:e,s),t.setValueAtTime(e,s)}ramp(t,e,s=null,n=null,r=null){e<(null!=n?n:t.value)?this.rampExp(t,e,s,n,r):this.rampLin(t,e,s,n,r)}ramps(t,e,...s){let n,r;for(;2<=s.length;){const i=s.shift(),h=s.shift()+e;this.ramp(t,i,h,n,r),n=i,r=h}}nowRamps(t,...e){this.ramps(t,f.now,...e)}}class x extends g{constructor(t){super(),this._node=t}inlet(){return this._node}outlet(){return this._node}}const m=t=>(class extends t{nodeStart(t){return this._node.start(t)}nodeStop(t){return this._node.stop(t)}});class b extends(m(x)){constructor(t="sine"){super(f.ctx.createOscillator()),this.node.type=t,this.cps=0,this.phs=0}get node(){return this._node}get cps(){return this.node.frequency.value}set cps(t){this.ramp(this.node.frequency,t)}get phs(){return this._phs}set phs(t){if(this._phs=t,"sine"!==this.node.type)return;const e=this.node;if(e){const s=l(1,t).toXY(),n=f.ctx.createPeriodicWave(new Float32Array([0,s.x]),new Float32Array([0,s.y]));e.setPeriodicWave(n)}}}class y extends x{constructor(t=0){super(f.ctx.createGain()),this.ramp(this.node.gain,t)}get node(){return this._node}get amp(){return this.node.gain.value}set amp(t){this.ramp(this.node.gain,t)}get amp2(){return Math.sqrt(this.amp)}set amp2(t){this.amp=t*t}}y.soft=.3,y.loud=.7,y.full=1;class w extends g{constructor(t="sine",e=0,s=0){super(),this.osc=new b(t),this.gai=new y(e),this.osc.sendTo(this.gai),this.pan=new M(s),this.gai.sendTo(this.pan)}inlet(){return this.osc.node}outlet(){return this.pan.node}nodeStart(t){this.osc.nodeStart(t)}nodeStop(t){this.osc.nodeStop(t)}}class M extends x{constructor(t=0){super(f.ctx.createStereoPanner()),this.pan=t}get node(){return this._node}get pan(){return this.node.pan.value}set pan(t){this.ramp(this.node.pan,t)}left(){this.pan=-1}center(){this.pan=0}right(){this.pan=1}}class $ extends(m(x)){constructor(){super(f.ctx.createBufferSource())}get node(){return this._node}nodeStart(t){this.node.start(t)}nodeStop(t){this.node.stop(t)}createBuffer(t,e){const s=f.ctx.createBuffer(1,t,f.sr),n=s.getChannelData(0);for(let s=0;s<t;++s)n[s]=e(s);this.node.buffer=s,this.node.loop=!0}}class N extends ${constructor(){super(),this.createBuffer(8*f.sr,()=>2*Math.random()-1)}}class v{constructor(){this._b0=0,this._b1=0,this._b2=0,this._b3=0,this._b4=0,this._b5=0,this._b6=0}nextSample(){const t=2*Math.random()-1;this._b0=.99886*this._b0+.0555179*t,this._b1=.99332*this._b1+.0750759*t,this._b2=.969*this._b2+.153852*t,this._b3=.8665*this._b3+.3104856*t,this._b4=.55*this._b4+.5329522*t,this._b5=-.7616*this._b5-.016898*t;const e=.22*(this._b0+this._b1+this._b2+this._b3+this._b4+this._b5+this._b6+.5362*t);return this._b6=.115926*t,e}}class S extends ${constructor(){super();const t=new v;this.createBuffer(8*f.sr,()=>t.nextSample())}}p("Klang",()=>(class{static tone(t,e,s="sine"){if(t._klang){const e=t._klang;delete t._klang,e.nowRamps(e.gai.node.gain,0,.23),e.deleteAfter(.3)}else{const n=new w(s);n.sendToDest(),t._klang=n,n.osc.cps=e,n.start(),n.nowRamps(n.gai.node.gain,.2,.23)}}static _bufferKlang(t,e){if(t._klang){let[e,s]=t._klang;delete t._klang,e.nowRamps(e.node.gain,0,.23),e.deleteAfter(.3),s.deleteAfter(.3)}else{const s=new y;s.sendToDest();const n=new e;n.sendTo(s),t._klang=[s,n],n.start(),s.nowRamps(s.node.gain,.2,.23)}}static whiteNoise(t){this._bufferKlang(t,N)}static pinkNoise(t){this._bufferKlang(t,S)}static noise(t,e){return"white"===e?this.whiteNoise(t):"pink"===e?this.pinkNoise(t):this.tone(t,0)}static sineTone(t=0){const e=new w("sine",0,t);return e.sendToDest(),e.cps=(t=>e.osc.cps=t),e.amp=(t=>e.gai.amp=t),e.start(),e}}))}]);