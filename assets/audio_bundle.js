var MC=MC||{};MC.PI2=Math.PI/2,MC.PIPI=2*Math.PI,MC.normPIPI=function(b){return 0>b||MC.PIPI<=b?b-Math.floor(b/MC.PIPI)*MC.PIPI:b},MC.normPI=function(b){return(b=this.normPIPI(b))<=Math.PI?b:b-MC.PIPI};class XY{constructor(a,b){this.x=a,this.y=b}toString(){return`(${this.x}:${this.y})`}make(a,b){return this.constructor.make(a,b)}static make(a,b){return new this(a,null==b?a:b)}static _0(){return this.make(0,0)}clone(){return this.make(this.x,this.y)}is0(){return 0===this.x&&0===this.y}eq(a){return this.x===a.x&&this.y===a.y}plus(a){return this.make(this.x+a.x,this.y+a.y)}minus(a){return this.make(this.x-a.x,this.y-a.y)}times(a){return a instanceof XY?this.make(this.x*a.x,this.y*a.y):this.make(this.x*a,this.y*a)}div(a){return a instanceof this.constructor?this.make(this.x/a.x,this.y/a.y):this.make(this.x/a,this.y/a)}neg(){return this.make(-this.x,-this.y)}mag(){return this.x*this.x+this.y*this.y}lgt(){return Math.sqrt(this.mag())}min(a){var b=Math.min;return this.make(b(this.x,a.x),b(this.y,a.y))}max(a){var b=Math.max;return this.make(b(this.x,a.x),b(this.y,a.y))}bound(a,b){return this.min(b).max(a)}get minLgt(){return Math.min(this.x,this.y)}get maxLgt(){return Math.max(this.x,this.y)}dot(a){return this.x*a.x+this.y*a.y}cross(a){return this.x*a.y-this.y*a.x}unit(){const a=this.lgt();return 0<a?this.div(a):this.make(1,0)}angle(){if(0===this.x)return 0===this.y?0:(0<this.y?1:3)*MC.PI2;const b=Math.atan(this.y/this.x);return 0<this.x?b+Math.PI:b}static fromXY(a){return this.make(a.x,a.y)}static fromWH(a){return this.make(a.w,a.h)}toRA(){const a=this.lgt();return 0<a?RA.make(a,this.angle()):RA.make(0,0)}}class RA{constructor(b,c){this.r=b,this.a=c,this._norm()}toString(){return`(${this.r}/${this.a})`}make(b,c){return this.constructor.make(b,c)}static make(b,c){return new this(b,c)}static _0(){return this.make(0,0)}clone(){return this.make(this.r,this.a)}is0(){return 0===this.r}eq(a){return this.r===a.r&&(this.is0()||this.a===a.a)}_norm(){0>this.r&&(this.r=-this.r,this.a+=Math.PI),this.a=MC.normPIPI(this.a)}toXY(){return MC.xy(this.r*Math.cos(this.a),this.r*Math.sin(this.a))}}class Trf{constructor(a){this.xy=a}toString(){const a=this.xy.toString();return`[${a}]`}static make(a){return new this(a)}static _0(){return this.make(XY._0())}svgString(){return this.is0()?'':`translate(${this.xy.x} ${this.xy.y}) `}is0(){return this.xy.is0()}get dx(){return this.xy.x}get dy(){return this.xy.y}plus(a){return new this.constructor(this.xy.plus(a))}}MC.XY=XY,MC.RA=RA,MC.Trf=Trf,MC.xy=(a,b)=>XY.make(a,b),MC.ra=(b,c)=>RA.make(b,c),MC.trf=(a)=>new Trf(a);var MC=MC||{};const Audio={};Audio.ctx=new AudioContext,Audio.sr=Audio.ctx.sampleRate,Audio.now=()=>Audio.ctx.currentTime,Audio.dest=null,Audio.mute=()=>{Audio.dest&&Audio.dest.node.gain.linearRampToValueAtTime(0,Audio.now()+.1)},Audio.after=(a,b)=>{setTimeout(()=>{b()},1e3*a)},Audio.sequence=(...a)=>{const b=()=>{if(a.length){const[c,d]=a.shift();setTimeout(()=>{d(),b()},1e3*c)}};b()},window.addEventListener('beforeunload',()=>Audio.mute());class ANode{constructor(){this._startState=0}inlet(){return null}outlet(){return null}start(a=0){return!(0!==this._startState)&&(this.nodeStart(a),this._startState=1,!0)}stop(a=0){return!(1!==this._startState)&&(this.nodeStop(a),this._startState=2,!0)}nodeStart(){}nodeStop(){}sendTo(a=null){const b=this.outlet();if(b&&(b.disconnect(),a)){const c=a.inlet();c&&b.connect(c)}}sendToDest(){this.sendTo(Audio.dest)}deleteAfter(a){Audio.after(a+.01,()=>{this.stop(),this.sendTo()})}static _ramp(a,b,c,d,e,f){if(null==f&&(f=Audio.now()),null==d&&(d=f+.01),a.cancelScheduledValues(f),null!=e&&a.setValueAtTime(e,f),b){const b=0>=c;a.exponentialRampToValueAtTime(b?1e-4:c,d),b&&a.setValueAtTime(c,d)}else a.linearRampToValueAtTime(c,d)}rampLin(a,b,c,d,e){this.constructor._ramp(a,!1,b,c,d,e)}rampExp(a,b,c,d,e){this.constructor._ramp(a,!0,b,c,d,e)}ramp(a,b,c,d,e){const f=null==d?a.value:d;this.constructor._ramp(a,b<f,b,c,d,e)}ramps(a,b,...c){for(let d,e;2<=c.length;){const f=c.shift(),g=c.shift()+b;this.ramp(a,f,g,d,e),d=f,e=g}}nowRamps(a,...b){this.ramps(a,Audio.now(),...b)}}class AuNode extends ANode{constructor(a){super(),this._node=a}inlet(){return this._node}outlet(){return this._node}}const hasStartStop=(a)=>class extends a{nodeStart(a){return this._node.start(a)}nodeStop(a){return this._node.stop(a)}};class Osc extends hasStartStop(AuNode){constructor(a='sine'){super(Audio.ctx.createOscillator()),this.node.type=a,this.cps=0,this.phs=0}get node(){return this._node}get cps(){return this.node.frequency.value}set cps(a){this.ramp(this.node.frequency,a)}get phs(){return this._phs}set phs(a){if(this._phs=a,'sine'===this.node.type){const b=this.node;if(b){const c=MC.ra(1,a).toXY(),d=Audio.ctx.createPeriodicWave(new Float32Array([0,c.x]),new Float32Array([0,c.y]));b.setPeriodicWave(d)}}}}class Gain extends AuNode{constructor(a=0){super(Audio.ctx.createGain()),this.ramp(this.node.gain,a)}get node(){return this._node}get amp(){return this.node.gain.value}set amp(a){this.ramp(this.node.gain,a)}get amp2(){return Math.sqrt(this.amp)}set amp2(a){this.amp=a*a}}Gain.soft=0.3,Gain.loud=0.7,Gain.full=1;class OscGain extends ANode{constructor(a='sine',b=0,c=0){super(),this.osc=new Osc(a),this.gai=new Gain(b),this.osc.sendTo(this.gai),this.pan=new Pan(c),this.gai.sendTo(this.pan)}inlet(){return this.osc.node}outlet(){return this.pan.node}nodeStart(a){this.osc.nodeStart(a)}nodeStop(a){this.osc.nodeStop(a)}}class Pan extends AuNode{constructor(a=0){super(Audio.ctx.createStereoPanner()),this.pan=a}get node(){return this._node}get pan(){return this.node.pan.value}set pan(a){this.ramp(this.node.pan,a)}left(){this.pan=-1}center(){this.pan=0}right(){this.pan=1}}class Delay extends AuNode{constructor(a=0){super(Audio.ctx.createDelay()),this.delay=a}get node(){return this._node}get delay(){return this.node.delayTime}set delay(a){this.node.delayTime=a}}class AudioBufferSource extends hasStartStop(AuNode){constructor(){super(Audio.ctx.createBufferSource())}get node(){return this._node}nodeStart(a){this.node.start(a)}nodeStop(a){this.node.stop(a)}createBuffer(a,b){const c=Audio.ctx.createBuffer(1,a,Audio.sr),d=c.getChannelData(0);for(let c=0;c<a;++c)d[c]=b(c);this.node.buffer=c,this.node.loop=!0}}class WhiteNoise extends AudioBufferSource{constructor(){super(),this.createBuffer(8*Audio.sr,()=>2*Math.random()-1)}}class PinkNoiseGenerator{constructor(){this._b0=0,this._b1=0,this._b2=0,this._b3=0,this._b4=0,this._b5=0,this._b6=0}nextSample(){const a=2*Math.random()-1;this._b0=0.99886*this._b0+0.0555179*a,this._b1=0.99332*this._b1+0.0750759*a,this._b2=0.969*this._b2+0.153852*a,this._b3=0.8665*this._b3+0.3104856*a,this._b4=0.55*this._b4+0.5329522*a,this._b5=-0.7616*this._b5-0.016898*a;const b=0.22*(this._b0+this._b1+this._b2+this._b3+this._b4+this._b5+this._b6+0.5362*a);return this._b6=0.115926*a,b}}class PinkNoise extends AudioBufferSource{constructor(){super();const a=new PinkNoiseGenerator;this.createBuffer(8*MC.Audio.sr,()=>a.nextSample())}}class Filter extends AuNode{constructor(a='peaking'){super(Audio.ctx.createBiquadFilter());const b=this.node;b.type=a,b.frequency.value=0,b.Q.value=0,b.gain.value=0}get node(){return this._node}get Q(){return this.node.Q.value}set Q(a){this.node.Q.value=a}get gain(){return this.node.gain.value}set gain(a){this.node.gain.value=a}get cps(){return this.node.frequency.value}set cps(a){this.ramp(this.node.frequency,a)}}(Audio.dest=new Gain(1)).node.connect(Audio.ctx.destination),Audio.beep=(a,b,c)=>{const d=new OscGain;d.osc.cps=a,d.sendToDest(),d.start(),d.nowRamps(d.gai.node.gain,.3,2*(c/3),0,c/3),d.deleteAfter(c)},Audio.testBeep=()=>{Audio.beep(880,.3,.12)},MC.Osc=Osc,MC.Gain=Gain,MC.OscGain=OscGain,MC.Delay=Delay,MC.WhiteNoise=WhiteNoise,MC.PinkNoise=PinkNoise,MC.Filter=Filter,MC.Audio=Audio;var MC=MC||{};class Klang{static tone(a,b,c='sine'){if(!a._klang){const d=new MC.OscGain(c);d.sendToDest(),a._klang=d,d.osc.cps=b,d.start(),d.nowRamps(d.gai.node.gain,.2,.23)}else{const b=a._klang;delete a._klang,b.nowRamps(b.gai.node.gain,0,.23),b.deleteAfter(.3)}}static _bufferKlang(a,c){if(!a._klang){const d=new MC.Gain;d.sendToDest();const e=new c;e.sendTo(d),a._klang=[d,e],e.start(),d.nowRamps(d.node.gain,.2,.23)}else{let[c,d]=a._klang;delete a._klang,c.nowRamps(c.node.gain,0,.23),c.deleteAfter(.3),d.deleteAfter(.3)}}static whiteNoise(a){this._bufferKlang(a,MC.WhiteNoise)}static pinkNoise(a){this._bufferKlang(a,MC.PinkNoise)}static noise(a,b){return'white'===b?this.whiteNoise(a):'pink'===b?this.pinkNoise(a):this.tone(a,0)}static sineTone(a=0){const b=new MC.OscGain('sine',0,a);return b.sendToDest(),b.cps=(a)=>b.osc.cps=a,b.amp=(a)=>b.gai.amp=a,b.start(),b}}MC.Klang=Klang;var MC=MC||{};class WrappedElement{constructor(a,b){this._el=WrappedElement.elSel(a),this.sz=b?b.clone():XY.make(this.el.clientWidth,this.el.clientHeight),this._onResize=null,window.addEventListener('resize',()=>this._callOnResize())}_callOnResize(){this._onResize&&this._onResize(window.innerWidth,window.innerHeight)}set onResize(a){this._onResize=a,this._callOnResize()}get minSize(){return 0}resize(a){const b=a?a:this.sz,c=this.minSize;this.sz=b.max(XY.make(c,c))}resizeToSquare(){this.resize(XY.make(this.sz.maxLgt))}availableRectangle(a=MC.xy0(),b){const c=this.el.parentElement,d=c.clientWidth;let e=c.clientHeight;768>=d&&(e=d);let f=XY.make(d,e);return b&&(f=f.min(b)),f=f.max(a),f}availableSquare(){return XY.make(this.availableRectangle().minLgt)}static elSel(a){return'string'==typeof a?document.querySelector(a):WrappedElement.prototype===Object.getPrototypeOf(a)?a.el:a}get el(){return this._el}addClass(a){this.el.classList.add(a)}remClass(a){this.el.classList.remove(a)}hasClass(a){return this.el.classList.contains(a)}toggleClass(a,b){return this.el.classList.toggle(a,b)}isShown(){return!this.hasClass('hidden')}show(a=!0){this.toggleClass('hidden',!a)}hide(){this.show(!1)}set width(a){this.el.style.width=`${a}px`}set height(a){this.el.style.height=`${a}px`}set color(a){this.el.style.color=a}set background(a){this.el.style.background=a}get sz(){return MC.xy(this.el.clientHeight,this.el.clientHeight)}set sz(a){this.width=a.x,this.height=a.y}get bsz(){const a=this.el.getBoundingClientRect();return MC.xy(a.width,a.height)}}MC.WrappedElement=WrappedElement,MC.wrapElement=(a)=>new WrappedElement(a);class Container extends WrappedElement{constructor(a,b,c){super(a,c),this.innerElem=b,this.el.style.position='relative',this.el.append(b);const d=b.style;d.position='absolute',d.width='100%',d.height='100%',this.resize(c),this.scene=new Scene(this)}get minSize(){return 32}get bg(){return this.scene.bg}get fg(){return this.scene.fg}}class SvgContainer extends Container{constructor(a,b){super(a,new SVGSVGElement,b)}get svgElem(){return this.innerElem}}var MC=MC||{};class SceneNode{constructor(a,b){this.parent=a,this.el=b}setElem(a,b){this.remElem(),parent.el.children.insert(a,this.el=b)}remElem(){this.el&&this.el.remove()}_attrs(){}getAttr(a){return this.el.attributes.getNamedItem(a).value}setAttr(a,b){if(null==b)this.el.attributes.removeNamedItem(a);else{const c=document.createAttribute(a);c.value='string'==typeof b?b:b.toString(),this.el.attributes.setNamedItem(c)}}isShown(){return'none'!=this.getAttr('display')}show(a=!0){this.setAttr('display',a?'':'none')}hide(){this.show(!1)}set stroke(a){this.setAttr('stroke',a)}get stroke(){return this.getAttr('stroke')}set fill(a){this.setAttr('fill',a)}get fill(){return this.getAttr('fill')}set color(a){this.stroke=a,this.fill=a}set width(a){this.setAttr('stroke-width',a)}set lineCap(a){this.setAttr('stroke-linecap',a)}set lineJoin(a){this.setAttr('stroke-linejoin',a)}set dashArray(a){this.setAttr('stroke-dasharray',a)}solidStroke(){this.dashArray=null}dottedStroke(){this.dashArray='1,3'}dashedStroke(){this.dashArray='3,2'}}class GroupNode extends SceneNode{constructor(a,b){super(a,b?b:new SVGGElement),this.nodes=[],this.trf=MC.trf0(),this._attrs()}get trf(){return this.trf}set trf(a){this.trf=a,this._attrTR()}get p(){return this.trf.xy}set p(a){this.trf.xy=a}get gp(){const a=this.p;return parent?parent.pageXOffset.plus(a):a}_attrTR(){this.setAttr('transform',this.trf.svgString())}_attrs(){super._attrs(),this._attrTR()}isRoot(){return!!parent}get isEmpty(){return!this.nodes.length}group(){return this.add(new GroupNode(this))}get bg(){return this._bg?this._bg:this.back(this._bg=new GroupNode(this))}get fg(){return this._fg?this._fg:this.front(this._fg=new GroupNode(this))}add(a,b=!0){const c=a;return null!=c.parent&&c.parent.rem(c),c.parent=this,b?this.nodes.push(c):this.nodes.unshift(c),c.setElem(b?this.nodes.length-1:0,c.el),a}front(a){return this.add(a,!1)}back(a){return this.add(a,!0)}rem(a){const b=this.nodes;b.splice(b.indexOf(a),1),a.remElem(),a.parent=null}}class Scene extends GroupNode{constructor(a){super(null,a.innerElem),this._attrs(),this._lastPointerPos=XY._0(),this.off=XY._0()}_attrs(){super._attrs(),this.stroke='black',this.width=1,this.fill='none',this.lineCap='round'}pointerPos(a,b){if(b){const a=XY._0();this.off=XY.make(window.scrollX-a.x,window.scrollY-a.y)}let c;if(a.prototype===MouseEvent)c=XY.make(a.clientX,a.clientY);else{var d=a.targetTouches;if(!d||!d.length)return this._lastPointerPos;c=XY.make(d[0].clientX,d[0].clientY)}return this._lastPointerPos=this.off.plus(c)}oneStream(a,b,c){this.el.addEventListener(a,c),this.el.addEventListener(b,c)}onBeginEvent(a){this.oneStream('mousedown','touchstart',function(b){b.preventDefault(),a(this.pointerPos(b,!0))})}onMoveBegin(a,b,c){b&&b(a),c&&(this._onMove=c)}onMoveMove(){}onMoveEnd(){}}var MC=MC||{};class Shape extends SceneNode{constructor(a,b){super(a,b)}get cursor(){return this.getAttr('cursor')}set cursor(a){this.setAttr('cursor',a)}}